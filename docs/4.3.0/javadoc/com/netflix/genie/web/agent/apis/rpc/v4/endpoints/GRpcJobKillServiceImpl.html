<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>GRpcJobKillServiceImpl (genie 4.3.0 API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../../../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../../../../jquery/jquery-ui.css" title="Style">
<script type="text/javascript" src="../../../../../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../../../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../../../../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../../../../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../../../../../../jquery/jquery-3.3.1.js"></script>
<script type="text/javascript" src="../../../../../../../../../jquery/jquery-migrate-3.0.1.js"></script>
<script type="text/javascript" src="../../../../../../../../../jquery/jquery-ui.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="GRpcJobKillServiceImpl (genie 4.3.0 API)";
        }
    }
    catch(err) {
    }
//-->
var data = {"i0":10,"i1":10,"i2":10,"i3":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../../../../../../../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">com.netflix.genie.web.agent.apis.rpc.v4.endpoints</a></div>
<h2 title="Class GRpcJobKillServiceImpl" class="title">Class GRpcJobKillServiceImpl</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>com.netflix.genie.proto.JobKillServiceGrpc.JobKillServiceImplBase</li>
<li>
<ul class="inheritance">
<li>com.netflix.genie.web.agent.apis.rpc.v4.endpoints.GRpcJobKillServiceImpl</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><code><a href="../../../../../services/JobKillService.html" title="interface in com.netflix.genie.web.services">JobKillService</a></code>, <code>io.grpc.BindableService</code></dd>
</dl>
<hr>
<pre>public class <span class="typeNameLabel">GRpcJobKillServiceImpl</span>
extends com.netflix.genie.proto.JobKillServiceGrpc.JobKillServiceImplBase
implements <a href="../../../../../services/JobKillService.html" title="interface in com.netflix.genie.web.services">JobKillService</a></pre>
<div class="block">Implementation of <a href="../../../../../services/JobKillService.html" title="interface in com.netflix.genie.web.services"><code>JobKillService</code></a> which uses parked gRPC requests to tell the agent to
 shutdown via a user kill request if the job is in an active state.</div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>4.0.0</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Constructor</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr class="altColor">
<th class="colConstructorName" scope="row"><code><span class="memberNameLink"><a href="#%3Cinit%3E(com.netflix.genie.web.data.services.DataServices,com.netflix.genie.web.agent.services.AgentRoutingService,com.netflix.genie.web.services.RequestForwardingService)">GRpcJobKillServiceImpl</a></span>&#8203;(<a href="../../../../../data/services/DataServices.html" title="class in com.netflix.genie.web.data.services">DataServices</a>&nbsp;dataServices,
                      <a href="../../../../services/AgentRoutingService.html" title="interface in com.netflix.genie.web.agent.services">AgentRoutingService</a>&nbsp;agentRoutingService,
                      <a href="../../../../../services/RequestForwardingService.html" title="interface in com.netflix.genie.web.services">RequestForwardingService</a>&nbsp;requestForwardingService)</code></th>
<td class="colLast">
<div class="block">Constructor.</div>
</td>
</tr>
</table>
</li>
</ul>
</section>
<!-- ========== METHOD SUMMARY =========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#cleanupOrphanedObservers()">cleanupOrphanedObservers</a></span>()</code></th>
<td class="colLast">
<div class="block">Remove orphaned kill observers from local map.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>protected boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#isStreamObserverCancelled(io.grpc.stub.StreamObserver)">isStreamObserverCancelled</a></span>&#8203;(io.grpc.stub.StreamObserver&lt;com.netflix.genie.proto.JobKillRegistrationResponse&gt;&nbsp;observer)</code></th>
<td class="colLast">
<div class="block">Converts StreamObserver into ServerCallStreamObserver in order to tell
 whether the observer is cancelled or not.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#killJob(java.lang.String,java.lang.String,javax.servlet.http.HttpServletRequest)">killJob</a></span>&#8203;(java.lang.String&nbsp;jobId,
       java.lang.String&nbsp;reason,
       javax.servlet.http.HttpServletRequest&nbsp;request)</code></th>
<td class="colLast">
<div class="block">Kill the job with the given id if possible.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#registerForKillNotification(com.netflix.genie.proto.JobKillRegistrationRequest,io.grpc.stub.StreamObserver)">registerForKillNotification</a></span>&#8203;(com.netflix.genie.proto.JobKillRegistrationRequest&nbsp;request,
                           io.grpc.stub.StreamObserver&lt;com.netflix.genie.proto.JobKillRegistrationResponse&gt;&nbsp;responseObserver)</code></th>
<td class="colLast">
<div class="block">Register to be notified when a kill request for the job is received.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a id="methods.inherited.from.class.com.netflix.genie.proto.JobKillServiceGrpc.JobKillServiceImplBase">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;com.netflix.genie.proto.JobKillServiceGrpc.JobKillServiceImplBase</h3>
<code>bindService</code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a id="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a id="&lt;init&gt;(com.netflix.genie.web.data.services.DataServices,com.netflix.genie.web.agent.services.AgentRoutingService,com.netflix.genie.web.services.RequestForwardingService)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>GRpcJobKillServiceImpl</h4>
<pre>public&nbsp;GRpcJobKillServiceImpl&#8203;(<a href="../../../../../data/services/DataServices.html" title="class in com.netflix.genie.web.data.services">DataServices</a>&nbsp;dataServices,
                              <a href="../../../../services/AgentRoutingService.html" title="interface in com.netflix.genie.web.agent.services">AgentRoutingService</a>&nbsp;agentRoutingService,
                              <a href="../../../../../services/RequestForwardingService.html" title="interface in com.netflix.genie.web.services">RequestForwardingService</a>&nbsp;requestForwardingService)</pre>
<div class="block">Constructor.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>dataServices</code> - The <a href="../../../../../data/services/DataServices.html" title="class in com.netflix.genie.web.data.services"><code>DataServices</code></a> instance to use</dd>
<dd><code>agentRoutingService</code> - The <a href="../../../../services/AgentRoutingService.html" title="interface in com.netflix.genie.web.agent.services"><code>AgentRoutingService</code></a> instance to use to find where agents are
                                 connected</dd>
<dd><code>requestForwardingService</code> - The service to use to forward requests to other Genie nodes</dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
<!-- ============ METHOD DETAIL ========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a id="registerForKillNotification(com.netflix.genie.proto.JobKillRegistrationRequest,io.grpc.stub.StreamObserver)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>registerForKillNotification</h4>
<pre class="methodSignature">public&nbsp;void&nbsp;registerForKillNotification&#8203;(com.netflix.genie.proto.JobKillRegistrationRequest&nbsp;request,
                                        io.grpc.stub.StreamObserver&lt;com.netflix.genie.proto.JobKillRegistrationResponse&gt;&nbsp;responseObserver)</pre>
<div class="block">Register to be notified when a kill request for the job is received.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Overrides:</span></dt>
<dd><code>registerForKillNotification</code>&nbsp;in class&nbsp;<code>com.netflix.genie.proto.JobKillServiceGrpc.JobKillServiceImplBase</code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>request</code> - Request to register for getting notified when server gets a job kill request.</dd>
<dd><code>responseObserver</code> - The response observer</dd>
</dl>
</li>
</ul>
<a id="killJob(java.lang.String,java.lang.String,javax.servlet.http.HttpServletRequest)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>killJob</h4>
<pre class="methodSignature">@Retryable(value={<a href="../../../../../../common/internal/exceptions/unchecked/GenieInvalidStatusException.html" title="class in com.netflix.genie.common.internal.exceptions.unchecked">GenieInvalidStatusException.class</a>,<a href="../../../../../../common/exceptions/GenieServerException.html" title="class in com.netflix.genie.common.exceptions">GenieServerException.class</a>},
           backoff=@Backoff(delay=1000L))
public&nbsp;void&nbsp;killJob&#8203;(java.lang.String&nbsp;jobId,
                    java.lang.String&nbsp;reason,
                    @Nullable
                    javax.servlet.http.HttpServletRequest&nbsp;request)
             throws <a href="../../../../../../common/internal/exceptions/unchecked/GenieJobNotFoundException.html" title="class in com.netflix.genie.common.internal.exceptions.unchecked">GenieJobNotFoundException</a>,
                    <a href="../../../../../../common/exceptions/GenieServerException.html" title="class in com.netflix.genie.common.exceptions">GenieServerException</a></pre>
<div class="block">Kill the job with the given id if possible.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../services/JobKillService.html#killJob(java.lang.String,java.lang.String,javax.servlet.http.HttpServletRequest)">killJob</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../services/JobKillService.html" title="interface in com.netflix.genie.web.services">JobKillService</a></code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>jobId</code> - id of job to kill</dd>
<dd><code>reason</code> - brief reason for requesting the job be killed</dd>
<dd><code>request</code> - The optional <code>HttpServletRequest</code> information if the request needs to be forwarded</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../common/internal/exceptions/unchecked/GenieJobNotFoundException.html" title="class in com.netflix.genie.common.internal.exceptions.unchecked">GenieJobNotFoundException</a></code> - When a job identified by jobId can't be found in the system</dd>
<dd><code><a href="../../../../../../common/exceptions/GenieServerException.html" title="class in com.netflix.genie.common.exceptions">GenieServerException</a></code> - if there is an unrecoverable error in the internal state of the Genie cluster</dd>
</dl>
</li>
</ul>
<a id="cleanupOrphanedObservers()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>cleanupOrphanedObservers</h4>
<pre class="methodSignature">@Scheduled(fixedDelay=30000L,
           initialDelay=30000L)
public&nbsp;void&nbsp;cleanupOrphanedObservers()</pre>
<div class="block">Remove orphaned kill observers from local map.
 <p>
 The logic as currently implemented is to have the Agent, once handshake is complete, open a connection to
 the server which results in parking a response observer in the map stored in this implementation. Upon receiving
 a kill request for the correct job this class will use the observer to send the "response" to the agent which
 will begin shut down process. The issue is that if the agent disconnects from this server the server will never
 realize it's gone and these observers will build up in the map in memory forever. This method will periodically
 go through the map and determine if the observers are still valid and remove any that aren't.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd>"GRpcAgentJobKillServiceImpl"</dd>
</dl>
</li>
</ul>
<a id="isStreamObserverCancelled(io.grpc.stub.StreamObserver)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>isStreamObserverCancelled</h4>
<pre class="methodSignature">protected&nbsp;boolean&nbsp;isStreamObserverCancelled&#8203;(io.grpc.stub.StreamObserver&lt;com.netflix.genie.proto.JobKillRegistrationResponse&gt;&nbsp;observer)</pre>
<div class="block">Converts StreamObserver into ServerCallStreamObserver in order to tell
 whether the observer is cancelled or not.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>observer</code> - Observer for which we would check the status</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Boolean value: true if observer has status CANCELLED</dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
</footer>
</body>
</html>
