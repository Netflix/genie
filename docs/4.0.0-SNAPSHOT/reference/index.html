<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="description" content="Reference documentation for Netflix OSS Genie">
<meta name="keywords" content="genie, netflix, documentation, big data, cloud, oss, open source software">
<meta name="author" content="Tom Gianos">
<title>Genie Reference Guide</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #111111; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #ad141e; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #ad141e; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Arial, sans-serif; font-weight: normal; font-style: normal; color: #111111; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #5e5e5e; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Andale Mono", "monotype.com", "Lucida Console", monospace; font-weight: normal; color: #222222; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.5; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.2; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; font-style: normal !important; letter-spacing: 0; padding: 2px; background-color: #eeeeee; -webkit-border-radius: 0; border-radius: 0; line-height: inherit; word-wrap: break-word; }
*:not(pre) > code.nobreak { word-wrap: normal; }
*:not(pre) > code.nowrap { white-space: nowrap; }

pre, pre > code { line-height: 1.5; color: white; font-family: Monaco, Consolas, "Courier New", Courier, Sans-serif; font-weight: normal; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: #555555; }

kbd { font-family: "Andale Mono", "monotype.com", "Lucida Console", monospace; display: inline-block; color: #222222; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: #151515; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: black; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #555555; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #6f6f6f; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #6f6f6f; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: black; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Helvetica Neue", "Helvetica", Arial, sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #111111; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f2f2f2; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.35; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #111111; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #040404; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: black; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: initial; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Arial, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #555555; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #111111; margin-top: 0; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #333333; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 0 solid #dddddd; -webkit-border-radius: 0; border-radius: 0; word-wrap: break-word; padding: 10px; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #333333; background-color: white; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 10px; -webkit-border-radius: 0; border-radius: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.5; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #6f6f6f; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #111111; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #555555; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #6f6f6f; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: inherit; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: #555555; }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.2; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:first-of-type img { max-width: initial; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #820f16; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

.literalblock pre, .listingblock pre { background: #333333; }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="icon" href="https://netflix.github.io/genie/assets/img/nficon2016.png" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-58620610-3', 'auto');
    ga('send', 'pageview');

</script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Genie Reference Guide</h1>
<div class="details">
<span id="author" class="author">Tom Gianos</span><br>
<span id="email" class="email"><a href="mailto:NetflixOSS@netflix.com">NetflixOSS@netflix.com</a></span><br>
<span id="revnumber">version 4.0.0-SNAPSHOT,</span>
<span id="revdate">2019-01-30</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_4_0_0_snapshot_release_notes">2. 4.0.0-SNAPSHOT Release Notes</a>
<ul class="sectlevel2">
<li><a href="#_features">2.1. Features</a></li>
<li><a href="#_library_upgrades">2.2. Library Upgrades</a></li>
<li><a href="#_property_changes">2.3. Property Changes</a>
<ul class="sectlevel3">
<li><a href="#_added">2.3.1. Added</a></li>
<li><a href="#_renamed">2.3.2. Renamed</a></li>
<li><a href="#_removed">2.3.3. Removed</a></li>
</ul>
</li>
<li><a href="#_metric_changes">2.4. Metric Changes</a>
<ul class="sectlevel3">
<li><a href="#_added_2">2.4.1. Added</a></li>
<li><a href="#_renamed_2">2.4.2. Renamed</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_3_3_0_release_notes">3. 3.3.0 Release Notes</a>
<ul class="sectlevel2">
<li><a href="#_features_2">3.1. Features</a></li>
<li><a href="#_upgrade_instructions">3.2. Upgrade Instructions</a></li>
<li><a href="#_library_upgrades_2">3.3. Library Upgrades</a></li>
</ul>
</li>
<li><a href="#_3_2_0_release_notes">4. 3.2.0 Release Notes</a>
<ul class="sectlevel2">
<li><a href="#_upgrade_instructions_2">4.1. Upgrade Instructions</a></li>
<li><a href="#_features_3">4.2. Features</a></li>
<li><a href="#_library_upgrades_3">4.3. Library Upgrades</a></li>
<li><a href="#_property_changes_2">4.4. Property Changes</a></li>
<li><a href="#_database_upgrades">4.5. Database Upgrades</a></li>
</ul>
</li>
<li><a href="#_3_1_0_release_notes">5. 3.1.0 Release Notes</a>
<ul class="sectlevel2">
<li><a href="#_features_4">5.1. Features</a></li>
<li><a href="#_library_upgrades_4">5.2. Library Upgrades</a></li>
<li><a href="#_property_changes_3">5.3. Property Changes</a>
<ul class="sectlevel3">
<li><a href="#_added_3">5.3.1. Added</a></li>
<li><a href="#_changed_default_value">5.3.2. Changed Default Value</a></li>
<li><a href="#_removed_2">5.3.3. Removed</a></li>
<li><a href="#_renamed_3">5.3.4. Renamed</a></li>
</ul>
</li>
<li><a href="#_database_upgrades_2">5.4. Database Upgrades</a></li>
</ul>
</li>
<li><a href="#_concepts">6. Concepts</a>
<ul class="sectlevel2">
<li><a href="#_data_model">6.1. Data Model</a>
<ul class="sectlevel3">
<li><a href="#_caveats">6.1.1. Caveats</a></li>
<li><a href="#_resources">6.1.2. Resources</a></li>
<li><a href="#_wrap_up">6.1.3. Wrap-up</a></li>
</ul>
</li>
<li><a href="#_how_it_works">6.2. How it Works</a>
<ul class="sectlevel3">
<li><a href="#_resource_configuration">6.2.1. Resource Configuration</a></li>
<li><a href="#_job_submission">6.2.2. Job Submission</a></li>
<li><a href="#_user_behavior">6.2.3. User Behavior</a></li>
<li><a href="#_wrap_up_2">6.2.4. Wrap Up</a></li>
</ul>
</li>
<li><a href="#_netflix_example">6.3. Netflix Example</a>
<ul class="sectlevel3">
<li><a href="#_configuration">6.3.1. Configuration</a></li>
<li><a href="#_job_submission_2">6.3.2. Job Submission</a></li>
<li><a href="#_wrap_up_3">6.3.3. Wrap Up</a></li>
</ul>
</li>
<li><a href="#_netflix_deployment">6.4. Netflix Deployment</a>
<ul class="sectlevel3">
<li><a href="#_components">6.4.1. Components</a></li>
<li><a href="#_wrap_up_4">6.4.2. Wrap Up</a></li>
</ul>
</li>
<li><a href="#_security">6.5. Security</a>
<ul class="sectlevel3">
<li><a href="#_architecture">6.5.1. Architecture</a></li>
<li><a href="#_rest_api_security">6.5.2. REST API Security</a></li>
<li><a href="#_ui_security">6.5.3. UI Security</a></li>
<li><a href="#_wrap_up_5">6.5.4. Wrap Up</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_features_5">7. Features</a>
<ul class="sectlevel2">
<li><a href="#_cluster_load_balancing">7.1. Cluster Load Balancing</a>
<ul class="sectlevel3">
<li><a href="#_randomizedclusterloadbalancerimpl">7.1.1. RandomizedClusterLoadBalancerImpl</a></li>
<li><a href="#_scriptloadbalancer">7.1.2. ScriptLoadBalancer</a></li>
<li><a href="#_wrap_up_6">7.1.3. Wrap Up</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_installation">8. Installation</a>
<ul class="sectlevel2">
<li><a href="#_standalone_jar">8.1. Standalone Jar</a></li>
<li><a href="#_tomcat_deployment">8.2. Tomcat Deployment</a></li>
<li><a href="#_configuration_3">8.3. Configuration</a>
<ul class="sectlevel3">
<li><a href="#_profiles">8.3.1. Profiles</a></li>
<li><a href="#_database">8.3.2. Database</a></li>
<li><a href="#_local_directories">8.3.3. Local Directories</a></li>
</ul>
</li>
<li><a href="#_wrap_up_7">8.4. Wrap Up</a></li>
</ul>
</li>
<li><a href="#_properties">9. Properties</a>
<ul class="sectlevel2">
<li><a href="#_default_properties">9.1. Default Properties</a>
<ul class="sectlevel3">
<li><a href="#_genie_properties">9.1.1. Genie Properties</a></li>
<li><a href="#_spring_properties">9.1.2. Spring Properties</a></li>
<li><a href="#_spring_cloud_properties">9.1.3. Spring Cloud Properties</a></li>
<li><a href="#_grpc_server_properties">9.1.4. gRPC Server properties</a></li>
</ul>
</li>
<li><a href="#_profile_specific_properties">9.2. Profile Specific Properties</a>
<ul class="sectlevel3">
<li><a href="#_prod_profile">9.2.1. Prod Profile</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_metrics">10. Metrics</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a><a class="link" href="#_introduction">1. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the reference documentation for Genie version 4.0.0-SNAPSHOT. Here you will find high level concept documentation
as well as documentation about how to install and configure this Genie version.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more Genie information see the <a href="https://netflix.github.io/genie">website</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For documentation of the REST API for this version of Genie please see the
<a href="https://netflix.github.io/genie/docs/4.0.0-SNAPSHOT/rest">API Guide</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For a demo of this version of Genie please see the
<a href="https://netflix.github.io/genie/docs/4.0.0-SNAPSHOT/demo">Demo Guide</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4_0_0_snapshot_release_notes"><a class="anchor" href="#_4_0_0_snapshot_release_notes"></a><a class="link" href="#_4_0_0_snapshot_release_notes">2. 4.0.0-SNAPSHOT Release Notes</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following are the release notes for Genie 4.0.0-SNAPSHOT.</p>
</div>
<div class="sect2">
<h3 id="_features"><a class="anchor" href="#_features"></a><a class="link" href="#_features">2.1. Features</a></h3>
<div class="ulist">
<ul>
<li>
<p>Upgrade to Spring Boot 2.0</p>
</li>
<li>
<p>Switch metric collection to use <a href="http://micrometer.io/">Micrometer</a></p>
<div class="ulist">
<ul>
<li>
<p>Allows users to plugin their own backend (Atlas, DataDog, etc)</p>
</li>
<li>
<p>Standard for Boot 2.0</p>
</li>
</ul>
</div>
</li>
<li>
<p>Switched to <a href="https://jcp.org/en/jsr/detail?id=310">JSR 310</a> classes for date and time manipulation</p>
</li>
<li>
<p>Upgrade to JPA 2.2</p>
</li>
<li>
<p>Integrate gRPC for Agent to server communication</p>
</li>
<li>
<p>Break 3.x security implementations into <code>genie-security</code> module</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_library_upgrades"><a class="anchor" href="#_library_upgrades"></a><a class="link" href="#_library_upgrades">2.2. Library Upgrades</a></h3>
<div class="ulist">
<ul>
<li>
<p>Spring Boot 2.0</p>
<div class="ulist">
<ul>
<li>
<p>Many changes see their
<a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Release-Notes">Release Notes</a> and
<a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide">Migration Guide</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Upgrade to <a href="http://hibernate.org/orm/releases/5.2/">Hibernate 5.2.x</a></p>
<div class="ulist">
<ul>
<li>
<p>Supports JPA 2.2 specification and JSR 310 Java 8 Times (including <code>Instant</code> which isn&#8217;t supported by JPA 2.2)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Switched to <a href="https://brettwooldridge.github.io/HikariCP/">HikariCP</a> for DB connection pool</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_property_changes"><a class="anchor" href="#_property_changes"></a><a class="link" href="#_property_changes">2.3. Property Changes</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Many Spring properties were changed as part of the Boot 2.0 release. Those are not documented here. Please
refer to their documentation.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_added"><a class="anchor" href="#_added"></a><a class="link" href="#_added">2.3.1. Added</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.useDefaultAwsCredentialsChain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to attempt creation of a standard AWS credentials chain.
See <a href="https://cloud.spring.io/spring-cloud-aws/">Spring Cloud AWS</a> for more information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.region.auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the AWS region will be attempted to be auto recognized via the AWS metadata services on EC2.
See <a href="https://cloud.spring.io/spring-cloud-aws/">Spring Cloud AWS</a> for more information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.region.static</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default AWS region. See <a href="https://cloud.spring.io/spring-cloud-aws/">Spring Cloud AWS</a> for more information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">us-east-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.stack.auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether auto stack detection is enabled.
See <a href="https://cloud.spring.io/spring-cloud-aws/">Spring Cloud AWS</a> for more information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management.endpoints.web.base-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default base path for the Spring Actuator[<a href="https://docs.spring.io/spring-boot/docs/current/actuator-api/html/" class="bare">https://docs.spring.io/spring-boot/docs/current/actuator-api/html/</a>]
management endpoints. Switched from default <code>/actuator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.aws.s3.buckets.[bucketName].roleARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For the bucket with name <code>bucketName</code> the ARN of the role to assume to read/write to that bucket. If a bucket is used
that isn&#8217;t listed in this map the default credentials configured will be used</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.aws.s3.buckets.[bucketName].region</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The AWS region the bucket with <code>bucketName</code> is in. Clients to talk to this bucket will be created in this region. If
no value is specified the bucket is assumed to be in the same region as the Genie process.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.grpc.server.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to start the gRPC server and services during server startup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.grpc.server.services.job-file-sync.ackIntervalMilliseconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How many milliseconds to wait between checks whether some acknowledgement should be sent to the agent regardless of
whether the <code>maxSyncMessages</code> threshold has been reached or not</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30,000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.grpc.server.services.job-file-sync.maxSyncMessages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How many messages to receive from the agent before an acknowledgement message is sent back from the server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.data.redis.repositories.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether Spring data repositories are enabled on top of redis as the backend store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.agent.filter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, enables the built-in agent filter service. The filter behavior is controlled by other active <code>genie.agent.filter.*</code> properties.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.agent.filter.version.minimum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Dynamic) The minimum version an agent needs to be (e.g., <code>1.2.3</code>) in order to communicate with this server. The filter needs to be enabled for this to take effect.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.agent.filter.version.blacklist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Dynamic) A regex matched against agent version (e.g., <code>1\.2\..*</code>), matching agents are rejected. The filter needs to be enabled for this to take effect.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.agent.filter.version.whitelist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Dynamic) A regex matched against agent version (e.g., <code>1\.2\..*</code>), agents not matching are rejected. The filter needs to be enabled for this to take effect.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_renamed"><a class="anchor" href="#_renamed"></a><a class="link" href="#_renamed">2.3.2. Renamed</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old Name</th>
<th class="tableblock halign-left valign-top">New Name</th>
<th class="tableblock halign-left valign-top">Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.clusterChecker.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.cluster-checker.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modifications to how Spring handled
<a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide#relaxed-binding">property binding</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.databaseCleanup.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.database-cleanup.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modifications to how Spring handled
<a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide#relaxed-binding">property binding</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.diskCleanup.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.disk-cleanup.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modifications to how Spring handled
<a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide#relaxed-binding">property binding</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.loadBalancers.script.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.load-balancers.script.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modifications to how Spring handled
<a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide#relaxed-binding">property binding</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.users.activeLimit.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.active-limit.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modifications to how Spring handled
<a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide#relaxed-binding">property binding</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.zookeeper.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Leverage existing code rather than re-invent the wheel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.zookeeper.connectionString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.connectString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Leverage existing code rather than re-invent the wheel</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_removed"><a class="anchor" href="#_removed"></a><a class="link" href="#_removed">2.3.3. Removed</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.aws.credentials.file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No longer necessary as <code>cloud.aws.credentials.useDefaultAwsCredentialsChain</code> is enabled by default an other Spring
Cloud AWS properties can be used to configure more specifically.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.aws.credentials.role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced with <code>genie.aws.s3.buckets.[bucketName].roleARN</code> for more specific control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.jackson.date-format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Switched to <code>java.time.Instant</code> from <code>java.util.Date</code> for timestamps. Formatting in ISO8601 supported out of the box
for <code>Instant</code> serialization/deserialization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.load-balancers.script.order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This behavior was to control the order the script load balancer was evaluated relative to other cluster load
balancer&#8217;s. This logic is more a framework or execution configuration than anything specific to the class itself. It
shouldn&#8217;t know how it&#8217;s used. The new mechanism is to provide an <code>@Order</code> annotation on beans that fit in the order
the user wants at runtime via a Spring bean definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.cleanup.deleteArchiveFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archival is now done in a flat structure to the destination location</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_metric_changes"><a class="anchor" href="#_metric_changes"></a><a class="link" href="#_metric_changes">2.4. Metric Changes</a></h3>
<div class="paragraph">
<p>Switched to <a href="http://micrometer.io/">Micrometer</a></p>
</div>
<div class="sect3">
<h4 id="_added_2"><a class="anchor" href="#_added_2"></a><a class="link" href="#_added_2">2.4.1. Added</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.services.agentJob.handshake.counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Count usages of 'handshake' protocol, record agent metadata and decision made</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_renamed_2"><a class="anchor" href="#_renamed_2"></a><a class="link" href="#_renamed_2">2.4.2. Renamed</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old Name</th>
<th class="tableblock halign-left valign-top">New Name</th>
<th class="tableblock halign-left valign-top">Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.coordination.clusterCommandQuery.timer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.services.specification.clusterCommandQuery.timer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functionality moved to new service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.submit.selectCluster.loadBalancer.counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.services.specification.loadBalancer.counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functionality moved to new service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.submit.localRunner.selectApplications.timer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.services.specification.selectApplications.timer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functionality moved to new service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.submit.localRunner.selectCluster.timer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.services.specification.selectCluster.timer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functionality moved to new service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.submit.selectCluster.noneSelected.counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.services.specification.selectCluster.noneSelected.counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functionality moved to new service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.submit.selectCluster.noneFound.counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.services.specification.selectCluster.noneFound.counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functionality moved to new service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.submit.localRunner.selectCommand.timer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.services.specification.selectCommand.timer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functionality moved to new service</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_3_0_release_notes"><a class="anchor" href="#_3_3_0_release_notes"></a><a class="link" href="#_3_3_0_release_notes">3. 3.3.0 Release Notes</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following are the release notes for Genie 3.3.0.</p>
</div>
<div class="sect2">
<h3 id="_features_2"><a class="anchor" href="#_features_2"></a><a class="link" href="#_features_2">3.1. Features</a></h3>
<div class="ulist">
<ul>
<li>
<p>Complete database schema and interaction code re-write for more normalization</p>
<div class="ulist">
<ul>
<li>
<p>Allows more insights into job and user behavior by breaking apart large JSON blobs and other denormalized fields</p>
</li>
<li>
<p>Improved cluster selection algorithm to speed up selection</p>
</li>
<li>
<p>Projections on tables improve data transfer speeds</p>
</li>
<li>
<p>Merge jobs tables to reduce duplicate data</p>
</li>
<li>
<p>Surrogate primary keys for improved join performance and space usage vs. Sting based external unique ids</p>
</li>
</ul>
</div>
</li>
<li>
<p>New fields added to jobs</p>
<div class="ulist">
<ul>
<li>
<p><code>grouping</code></p>
<div class="ulist">
<ul>
<li>
<p>A way to provide search for jobs related to each other. E.g. The name of an entire workflow in a job scheduler can
be set in this field to provide way to find all the jobs related to this workflow</p>
</li>
<li>
<p>Added to search API as optional field</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>groupingInstance</code></p>
<div class="ulist">
<ul>
<li>
<p>Building on <code>grouping</code> this provides a field for the unique instance of the grouping e.g. the run identifier of the
workflow</p>
</li>
<li>
<p>Added to search API as optional field</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>New field(s) added to Job Request, Job, Cluster, Command, Application</p>
<div class="ulist">
<ul>
<li>
<p><code>metadata</code></p>
<div class="ulist">
<ul>
<li>
<p>Allows users to insert any additional metadata they wish to these resources. <strong>MUST</strong> be valid JSON.</p>
</li>
<li>
<p>Stored as blob so no search available. Meant for use by higher level systems to take metadata and parse it
themselves for use in building up business use cases (lineage, relationships, etc) that the Genie data model doesn&#8217;t
support natively</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Switch to <a href="http://h2database.com/html/main.html">H2</a> for in memory database</p>
</li>
<li>
<p>Turn on Hibernate schema validation at boot</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_instructions"><a class="anchor" href="#_upgrade_instructions"></a><a class="link" href="#_upgrade_instructions">3.2. Upgrade Instructions</a></h3>
<div class="paragraph">
<p><a href="https://flywaydb.org/">Flyway</a> will upgrade the database schema for you. Due to performance reasons at large
scale, the data for jobs are not copied over between versions by default. Data for applications, commands and clusters
are copied so as not to interrupt operation. If you desire to copy over your old job data the tables were copied over
into {tableName}_old and for
<a href="https://raw.githubusercontent.com/Netflix/genie/v3.3.0/genie-ddl/src/main/sql/mysql/load-3.2.x-job-data-to-3.3.0.mysql.sql">MySQL</a>
and
<a href="https://raw.githubusercontent.com/Netflix/genie/v3.3.0/genie-ddl/src/main/sql/postgresql/load-3.2.x-job-data-to-3.3.0.postgresql.sql">PostgreSQL</a>
scripts exist to copy over the job data. You can execute these scripts on your database and they should be able to run
while your application is active and copy over data in the background.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you run the data movement scripts it will remove the old tables. If you don&#8217;t they will sit in your schema.
The next major Genie release will remove these tables in their schema upgrade scripts if they still exist. Feel free to
drop them yourself if they&#8217;re no longer needed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_library_upgrades_2"><a class="anchor" href="#_library_upgrades_2"></a><a class="link" href="#_library_upgrades_2">3.3. Library Upgrades</a></h3>
<div class="ulist">
<ul>
<li>
<p>Upgrade Spring Boot to 2.1.2.RELEASE</p>
</li>
<li>
<p>Upgrade to Spring Cloud Greenwich.RELEASE for cloud dependency management</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://cloud.spring.io/spring-cloud-static/Greenwich.RELEASE/">Reference Docs</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_2_0_release_notes"><a class="anchor" href="#_3_2_0_release_notes"></a><a class="link" href="#_3_2_0_release_notes">4. 3.2.0 Release Notes</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following are the release notes for Genie 3.2.0.</p>
</div>
<div class="sect2">
<h3 id="_upgrade_instructions_2"><a class="anchor" href="#_upgrade_instructions_2"></a><a class="link" href="#_upgrade_instructions_2">4.1. Upgrade Instructions</a></h3>
<div class="paragraph">
<p>If upgrading from existing 3.1.x installation run appropriate database upgrade script:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://raw.githubusercontent.com/Netflix/genie/v3.2.0/genie-ddl/src/main/sql/mysql/upgrade-3.1.x-to-3.2.0.mysql.sql">mysql</a></p>
</li>
<li>
<p><a href="https://raw.githubusercontent.com/Netflix/genie/v3.2.0/genie-ddl/src/main/sql/postgresql/upgrade-3.1.x-to-3.2.0.postgresql.sql">postgresql</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This <strong>must</strong> be done before deploying the 3.2.0 binary or Flyway will break. Going forward this will no longer be
necessary and Genie binary will package upgrade scripts and Flyway will apply them automatically.</p>
</div>
<div class="paragraph">
<p>Once the script is run you can deploy the 3.2.0 binary. Once successfully deployed in your db schema you should see a
new table <code>schema_version</code>. Do not delete or modify this table it is used by Flyway to manage upgrades.</p>
</div>
</div>
<div class="sect2">
<h3 id="_features_3"><a class="anchor" href="#_features_3"></a><a class="link" href="#_features_3">4.2. Features</a></h3>
<div class="ulist">
<ul>
<li>
<p>Database improvements</p>
<div class="ulist">
<ul>
<li>
<p>Switch to <a href="https://flywaydb.org/">Flyway</a> for database upgrade management</p>
</li>
</ul>
</div>
</li>
<li>
<p>Abstract internal eventing behind common interface</p>
</li>
<li>
<p>Bug fixes</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_library_upgrades_3"><a class="anchor" href="#_library_upgrades_3"></a><a class="link" href="#_library_upgrades_3">4.3. Library Upgrades</a></h3>
<div class="ulist">
<ul>
<li>
<p>Upgrade Spring Boot to 1.5.7.RELEASE</p>
</li>
<li>
<p>Upgrade to Spring Platform IO Brussels-SR5 for library dependency management</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.spring.io/platform/docs/Brussels-SR5/reference/htmlsingle/">Reference Docs</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Upgrade to Spring Cloud Dalston.SR3 for cloud dependency management</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://cloud.spring.io/spring-cloud-static/Dalston.SR3/">Reference Docs</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_property_changes_2"><a class="anchor" href="#_property_changes_2"></a><a class="link" href="#_property_changes_2">4.4. Property Changes</a></h3>

</div>
<div class="sect2">
<h3 id="_database_upgrades"><a class="anchor" href="#_database_upgrades"></a><a class="link" href="#_database_upgrades">4.5. Database Upgrades</a></h3>
<div class="ulist">
<ul>
<li>
<p>Standardize database schemas for consistency</p>
</li>
<li>
<p>Switch to <a href="https://flywaydb.org/">Flyway</a> for database upgrade management</p>
</li>
<li>
<p>If using MySQL now require 5.6.3+ due to properties needed. See <a href="#_installation">Installation</a> for details</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_1_0_release_notes"><a class="anchor" href="#_3_1_0_release_notes"></a><a class="link" href="#_3_1_0_release_notes">5. 3.1.0 Release Notes</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following are the release notes for Genie 3.1.0.</p>
</div>
<div class="sect2">
<h3 id="_features_4"><a class="anchor" href="#_features_4"></a><a class="link" href="#_features_4">5.1. Features</a></h3>
<div class="ulist">
<ul>
<li>
<p>Spring Session support made more flexible</p>
<div class="ulist">
<ul>
<li>
<p>Now can support none (off), Redis, JDBC and HashMap as session data stores based on spring.session.store-type
property</p>
</li>
</ul>
</div>
</li>
<li>
<p>Actuator endpoints secured by default</p>
<div class="ulist">
<ul>
<li>
<p>Follows new Spring default</p>
</li>
<li>
<p>Turn off by setting <code>management.security.enabled</code> to <code>false</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional cluster load balancer via Admin supplied script</p>
</li>
<li>
<p>Add dependencies to the Cluster and Command entities</p>
</li>
<li>
<p>Add configurations to the JobRequest entity</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_library_upgrades_4"><a class="anchor" href="#_library_upgrades_4"></a><a class="link" href="#_library_upgrades_4">5.2. Library Upgrades</a></h3>
<div class="ulist">
<ul>
<li>
<p>Upgrade Spring Boot from 1.3.8.RELEASE to 1.5.4.RELEASE</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-1.4-Release-Notes">1.4 Release Notes</a></p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-1.5-Release-Notes">1.5 Release Notes</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Upgrade to Spring Platform IO Brussels-SR3 for library dependency management</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.spring.io/platform/docs/Brussels-SR3/reference/htmlsingle/">Reference Docs</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Upgrade to Spring Cloud Dalston.SR2 for cloud dependency management</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://cloud.spring.io/spring-cloud-static/Dalston.SR2/">Reference Docs</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Removal of Spring Cloud Cluster</p>
<div class="ulist">
<ul>
<li>
<p>Spring Cloud Cluster was deprecated and the leadership election functionality previously leveraged by Genie was moved
to Spring Integration Zookeeper. That library is now used.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Tomcat upgraded to 8.5 from 8.0</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_property_changes_3"><a class="anchor" href="#_property_changes_3"></a><a class="link" href="#_property_changes_3">5.3. Property Changes</a></h3>
<div class="sect3">
<h4 id="_added_3"><a class="anchor" href="#_added_3"></a><a class="link" href="#_added_3">5.3.1. Added</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.loadBalancers.script.destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location on disk where the script source file should be stored after it is downloaded from
<code>genie.jobs.clusters.loadBalancers.script.source</code>. The file will be given the same name.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="file:///tmp/genie/loadbalancers/script/destination/" class="bare">file:///tmp/genie/loadbalancers/script/destination/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.loadBalancers.script.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the script based load balancer should be enabled for the system or not.
See also: <code>genie.jobs.clusters.loadBalancers.script.source</code>
See also: <code>genie.jobs.clusters.loadBalancers.script.destination</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.loadBalancers.script.order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The order which the script load balancer should be evaluated. The lower this number the sooner it is evaluated. 0
would be the first thing evaluated if nothing else is set to 0 as well. Must be &lt; 2147483647 (Integer.MAX_VALUE). If
no value set will be given Integer.MAX_VALUE - 1 (default).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2147483646</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.loadBalancers.script.refreshRate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How frequently to refresh the load balancer script (in milliseconds)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.loadBalancers.script.source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the script the load balancer should load to evaluate which cluster to use for a job request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="file:///tmp/genie/loadBalancers/script/source/loadBalance.js" class="bare">file:///tmp/genie/loadBalancers/script/source/loadBalance.js</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.loadBalancers.script.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time (in milliseconds) that the system will attempt to run the cluster load balancer script before it
forces a timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.databaseCleanup.batchSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of jobs to delete from the database at a time. Genie will loop until all jobs older than the retention
time are deleted.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management.security.roles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The roles a user needs to have in order to access the Actuator endpoints</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADMIN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.oauth2.resource.filter-order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The order the OAuth2 resource filter is places within the spring security chain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.data.redis.repositories.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether Spring data repositories should attempt to be created for Redis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.session.store-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The back end storage system for Spring to store HTTP session information. See
<a href="http://docs.spring.io/spring-boot/docs/2.1.2.RELEASE/reference/htmlsingle/#boot-features-session">Spring Boot Session</a>
for more information. Currently on classpath only none, hash_map, redis and jdbc will work.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hash_map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_changed_default_value"><a class="anchor" href="#_changed_default_value"></a><a class="link" href="#_changed_default_value">5.3.2. Changed Default Value</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Old Default</th>
<th class="tableblock halign-left valign-top">New Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.clusterChecker.healthIndicatorsToIgnore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory,genie,discoveryComposite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory,genieMemory,discoveryComposite</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management.security.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_removed_2"><a class="anchor" href="#_removed_2"></a><a class="link" href="#_removed_2">5.3.3. Removed</a></h4>

</div>
<div class="sect3">
<h4 id="_renamed_3"><a class="anchor" href="#_renamed_3"></a><a class="link" href="#_renamed_3">5.3.4. Renamed</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old Name</th>
<th class="tableblock halign-left valign-top">New Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multipart.max-file-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.http.multipart.max-file-size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multipart.max-request-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.http.multipart.max-file-size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cluster.leader.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.zookeeper.enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cluster.zookeeper.connect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.zookeeper.connectionString</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.cluster.zookeeper.namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.zookeeper.leader.path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.min-idle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.tomcat.min-idle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.max-idle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.tomcat.max-idle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.max-active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.tomcat.max-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.validation-query</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.tomcat.validation-query</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.test-on-borrow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.tomcat.test-on-borrow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.test-on-connect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.tomcat.test-on-connect</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.test-on-return</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.tomcat.test-on-return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.test-while-idle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.tomcat.test-while-idle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.min-evictable-idle-time-millis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.tomcat.min-evictable-idle-time-millis</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.time-between-eviction-run-millis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.tomcat.time-between-eviction-run-millis</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.jpa.hibernate.naming-strategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.jpa.hibernate.naming.strategy</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_database_upgrades_2"><a class="anchor" href="#_database_upgrades_2"></a><a class="link" href="#_database_upgrades_2">5.4. Database Upgrades</a></h3>
<div class="ulist">
<ul>
<li>
<p>Add cluster and command dependencies table</p>
</li>
<li>
<p>Rename MySQL and PostgreSQL schema files</p>
</li>
<li>
<p>Index 'name' column of Jobs table</p>
</li>
<li>
<p>Switch Job and JobRequest tables 'description' column to text</p>
</li>
<li>
<p>Switch Applications' table 'cluster_criterias' and 'command_criteria' columns to text</p>
</li>
<li>
<p>Increase the size of 'tags' column for applications, clusters, commands, jobs, job_requests</p>
</li>
<li>
<p>Switch JobRequest table 'dependencies' column to text</p>
</li>
<li>
<p>Add job request table configs column</p>
</li>
<li>
<p>Double the size of 'config' and 'dependencies' column for Application, Cluster, Command</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts"><a class="anchor" href="#_concepts"></a><a class="link" href="#_concepts">6. Concepts</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_data_model"><a class="anchor" href="#_data_model"></a><a class="link" href="#_data_model">6.1. Data Model</a></h3>
<div class="paragraph">
<p>The Genie 3 data model contains several modifications and additions to the
<a href="https://netflix.github.io/genie/concepts/2/DataModel.html">Genie 2 data model</a> to enable even more flexibility,
modularity and meta data retention. This section will go over the purpose of the various resources available from the
Genie API and how they interact together.</p>
</div>
<div class="sect3">
<h4 id="_caveats"><a class="anchor" href="#_caveats"></a><a class="link" href="#_caveats">6.1.1. Caveats</a></h4>
<div class="ulist">
<ul>
<li>
<p>The specific resource fields are <strong>NOT</strong> defined in this document. These fields are available in the
<a href="https://netflix.github.io/genie/docs/4.0.0-SNAPSHOT/rest/">REST API documentation</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_resources"><a class="anchor" href="#_resources"></a><a class="link" href="#_resources">6.1.2. Resources</a></h4>
<div class="paragraph">
<p>The following sections describe the various resources available from the Genie REST APIs. You should reference the
<a href="https://netflix.github.io/genie/docs/4.0.0-SNAPSHOT/rest/">API Docs</a> for how to manipulate these resources. These sections
will focus on the high level purposes for each resource and how they rely and/or interact with other resources within
the system.</p>
</div>
<div class="sect4">
<h5 id="_tagging"><a class="anchor" href="#_tagging"></a><a class="link" href="#_tagging">6.1.2.1. Tagging</a></h5>
<div class="paragraph">
<p>An important concept is the tagging of resources. Genie relies heavily on tags for how the system discovers
resources like clusters and commands for a job. Each of the core resources has a set of tags that can be associated
with them. These tags can be of set to whatever you want but it is recommended to come up with some sort of consistent
structure for your tags to make it easier for users to understand their purpose. For example at Netflix we&#8217;ve adopted
some of the following standards for our tags:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sched:{something}</code></p>
<div class="ulist">
<ul>
<li>
<p>This corresponds to any schedule like that this resource (likely a cluster) is expected to adhere to</p>
</li>
<li>
<p>e.g. <code>sched:sla</code> or <code>sched:adhoc</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>type:{something}</code></p>
<div class="ulist">
<ul>
<li>
<p>e.g. <code>type:yarn</code> or <code>type:presto</code> for a cluster or <code>type:hive</code> or <code>type:spark</code> for a command</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>ver:{something}</code></p>
<div class="ulist">
<ul>
<li>
<p>The specific version of said resource</p>
</li>
<li>
<p>e.g. two different Spark commands could have <code>ver:1.6.1</code> vs <code>ver:2.0.0</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>data:{something}</code></p>
<div class="ulist">
<ul>
<li>
<p>Used to classify the type of data a resource (usually a command) will access</p>
</li>
<li>
<p>e.g. <code>data:prod</code> or <code>data:test</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_resources"><a class="anchor" href="#_configuration_resources"></a><a class="link" href="#_configuration_resources">6.1.2.2. Configuration Resources</a></h5>
<div class="paragraph">
<p>The following resources (applications, commands and clusters) are considered configuration, or admin, resources.
They&#8217;re generally set up by the Genie administrator and available to all users for user with their jobs.</p>
</div>
<div class="sect5">
<h6 id="_application_resource"><a class="anchor" href="#_application_resource"></a><a class="link" href="#_application_resource">6.1.2.2.1. Application Resource</a></h6>
<div class="paragraph">
<p>An application resource represents pretty much what you&#8217;d expect. It is a reusable set of binaries, configuration files
and setup files that can be used to install and configure (surprise!) an application. Generally these resources are
used when an application isn&#8217;t already installed and on the <code>PATH</code> on a Genie node.</p>
</div>
<div class="paragraph">
<p>When a job is run the job Genie will download all the dependencies, configuration files and
setup files of each application and cluster and store it all in the job working directory. It will then
execute the setup script in order to install that application for that job. Genie is "dumb" as to the contents or
purpose of any of these files so the onus is on the administrators to create and test these packages.</p>
</div>
<div class="paragraph">
<p>Applications are very useful for decoupling application binaries from a Genie deployment. For example you could deploy
a Genie cluster and change the version of Hadoop, Hive, Spark that Genie will download without actually re-deploying
Genie. Applications can be combined together via a command. This will be explained more in the Command section.</p>
</div>
<div class="paragraph">
<p>The first entity to talk about is an application. Applications are linked to commands in order for binaries and
configurations to be downloaded and installed at runtime. Within Netflix this is frequently used to deploy new clients
without redeploying a Genie cluster.</p>
</div>
<div class="paragraph">
<p>At Netflix our applications frequently consists of a zip of all the binaries uploaded to s3 along with a setup file to
unzip and configure environment variables for that application.</p>
</div>
<div class="paragraph">
<p>It is important to note applications are entirely optional and if you prefer to just install all client binaries on a
Genie node beforehand you&#8217;re free to do that. It will save in overhead for job launch times but you will lose
flexibility in the trade-off.</p>
</div>
</div>
<div class="sect5">
<h6 id="_command_resource"><a class="anchor" href="#_command_resource"></a><a class="link" href="#_command_resource">6.1.2.2.2. Command Resource</a></h6>
<div class="paragraph">
<p>Commands resources primarily represent what a user would enter at the command line if you wanted to run a process on a
cluster and what binaries (i.e., applications) you would need on your PATH to make that possible.</p>
</div>
<div class="paragraph">
<p>Commands can have configuration, setup and dependencies files just like applications but primarily they should have an ordered list
of applications associated with them if necessary. For example lets take a typical scenario involving running Hive. To
run Hive you generally need a few things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A cluster to run its processing on (we&#8217;ll get to that in the Cluster section)</p>
</li>
<li>
<p>A hive-site.xml file which says what metastore to connect to amongst other settings</p>
</li>
<li>
<p>Hive binaries</p>
</li>
<li>
<p>Hadoop configurations and binaries</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>So a typical setup for Hive in Genie would be to have one, or many, Hive commands configured. Each command would have
its own hive-site.xml pointing to a specific metastore (prod, test, etc). Alternatively, site-specific configuration
can be associated to clusters and will be available to all commands executing against it.
The command would depend on Hadoop and Hive applications already configured which would have all the default
Hadoop and Hive binaries and configurations. All this would be combined in the job working directory in order to run Hive.</p>
</div>
<div class="paragraph">
<p>You can have any number of commands configured in the system. They should then be linked to the clusters they can
execute on. Clusters are explained next.</p>
</div>
</div>
<div class="sect5">
<h6 id="_cluster"><a class="anchor" href="#_cluster"></a><a class="link" href="#_cluster">6.1.2.2.3. Cluster</a></h6>
<div class="paragraph">
<p>A cluster stores all the details of an execution cluster including connection information, properties, etc. Some
cluster examples are Hadoop, Spark, Presto, etc. Every cluster can be linked to a set of commands that it can run.</p>
</div>
<div class="paragraph">
<p>Genie does <strong>not</strong> launch clusters for you. It merely stores metadata about the clusters you have running in your
environment so that jobs using commands and applications can connect to them.</p>
</div>
<div class="paragraph">
<p>Once a cluster has been linked to commands your Genie instance is ready to start running jobs. The job resources are
described in the following section. One important thing to note is that the list of commands linked to the cluster
is a priority ordered list. That means if you have two pig commands available on your system for the same cluster the
first one found in the list will be chosen provided all tags match. See <a href="#_how_it_works">How it Works</a> for more details.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_job_resources"><a class="anchor" href="#_job_resources"></a><a class="link" href="#_job_resources">6.1.2.3. Job Resources</a></h5>
<div class="paragraph">
<p>The following resources all relate to a user submitting and monitoring a given job. They are split up from the Genie 2
Job idea to provide better separation of concerns as usually a user doesn&#8217;t care about certain things. What node a
job ran on or its Linux process exit code for example.</p>
</div>
<div class="paragraph">
<p>Users interact with these entities directly though all but the initial job request are <strong>read-only</strong> in the sense you can
only get their current state back from Genie.</p>
</div>
<div class="sect5">
<h6 id="_job_request"><a class="anchor" href="#_job_request"></a><a class="link" href="#_job_request">6.1.2.3.1. Job Request</a></h6>
<div class="paragraph">
<p>This is the resource you use to kick off a job. It contains all the information the system needs to run a job.
Optionally the REST APIs can take attachments. All attachments and file dependencies are downloaded into the root of
the jobs working directory. The most important aspects are the command line arguments, the cluster criteria and the
command criteria. These dictate the which cluster, command and arguments will be used when the job is executed. See the
<a href="#_how_it_works">How it Works</a> section for more details.</p>
</div>
</div>
<div class="sect5">
<h6 id="_job"><a class="anchor" href="#_job"></a><a class="link" href="#_job">6.1.2.3.2. Job</a></h6>
<div class="paragraph">
<p>The job resource is created in the system after a Job Request is received. All the information a typical user would be
interested in should be contained within this resource. It has links to the command, cluster and applications used to
run the job as well as the meta information like status, start time, end time and others. See the
<a href="https://netflix.github.io/genie/docs/4.0.0-SNAPSHOT/rest/">REST API documentation</a> for more details.</p>
</div>
</div>
<div class="sect5">
<h6 id="_job_execution"><a class="anchor" href="#_job_execution"></a><a class="link" href="#_job_execution">6.1.2.3.3. Job Execution</a></h6>
<div class="paragraph">
<p>The job execution resource contains information about where a job was run and other information that may be more
interesting to a system admin than a regular user. Frequently useful in debugging.</p>
</div>
<div class="paragraph">
<p>A job contains all the details of a job request and execution including any command line arguments. Based on the
request parameters, a cluster and command combination is selected for execution. Job requests can also supply necessary
files to Genie either as attachments or using the file dependencies field if they already exist in an accessible file
system. As a job executes, its details are recorded in the job record within the Genie database.</p>
</div>
</div>
<div class="sect5">
<h6 id="_resource_configuration_vs_dependencies"><a class="anchor" href="#_resource_configuration_vs_dependencies"></a><a class="link" href="#_resource_configuration_vs_dependencies">6.1.2.3.4. Resource configuration vs. dependencies</a></h6>
<div class="paragraph">
<p>Genie allows associating files with the resources above so that these files are retrieved and placed in the job execution
directory as part of the setup.
When creating an Application, a Cluster, a Command or a Job, it is possible to associate <strong>configs</strong> and/or <strong>dependencies</strong>.
<strong>Configs</strong> are expected to be small configuration files (XML, JSON, YAML, &#8230;&#8203;), whereas <strong>dependencies</strong> are expected to be
larger and possibly binary (Jars, executables, libraries, etc).
Application, Cluster, and Command dependencies are deleted after job completion (unless Genie is configured to preserve
them), to avoid storing and archiving them over and over. Configurations are preserved. Job configurations and
dependencies are also preserved.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wrap_up"><a class="anchor" href="#_wrap_up"></a><a class="link" href="#_wrap_up">6.1.3. Wrap-up</a></h4>
<div class="paragraph">
<p>This section was intended to provide insight into how the Genie data model is thought out and works together. It is
meant to be very generic and support as many use cases as possible without modifications to the Genie codebase.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_it_works"><a class="anchor" href="#_how_it_works"></a><a class="link" href="#_how_it_works">6.2. How it Works</a></h3>
<div class="paragraph">
<p>This section is meant to provide context for how Genie can be configured with Clusters, Commands and Applications (see
<a href="#_data_model">Data Model</a> for details) and then how these work together in order to run a job on a Genie node.</p>
</div>
<div class="sect3">
<h4 id="_resource_configuration"><a class="anchor" href="#_resource_configuration"></a><a class="link" href="#_resource_configuration">6.2.1. Resource Configuration</a></h4>
<div class="paragraph">
<p>This section describes how configuration of Genie works from an administrator point of view. This isn&#8217;t how to
install and configure the Genie application itself. Rather it is how to configure the various resources involved in
running a job.</p>
</div>
<div class="sect4">
<h5 id="_register_resources"><a class="anchor" href="#_register_resources"></a><a class="link" href="#_register_resources">6.2.1.1. Register Resources</a></h5>
<div class="paragraph">
<p>All resources (clusters, commands, applications) should be registered with Genie before attempting to link them
together. Any files these resources depend on should be uploaded somewhere Genie can access them (S3, web server,
mounted disk, etc).</p>
</div>
<div class="paragraph">
<p>Tagging of the resources, particularly Clusters and Commands, is extremely important. Genie will use the tags in order
to find a cluster/command combination to run a job. You should come up with a convenient tagging scheme for your
organization. At Netflix we try to stick to a pattern for tags structures like <code>{tag category}:{tag value}</code>. For
example <code>type:yarn</code> or <code>data:prod</code>. This allows the tags to have some context so that when users look at what resources
are available they can find what to submit their jobs with so it is routed to the correct cluster/command combination.</p>
</div>
</div>
<div class="sect4">
<h5 id="_linking_resources"><a class="anchor" href="#_linking_resources"></a><a class="link" href="#_linking_resources">6.2.1.2. Linking Resources</a></h5>
<div class="paragraph">
<p>Once resources are registered they should be linked together. By linking we mean to represent relationships between the
resources.</p>
</div>
<div class="sect5">
<h6 id="_commands_for_a_cluster"><a class="anchor" href="#_commands_for_a_cluster"></a><a class="link" href="#_commands_for_a_cluster">6.2.1.2.1. Commands for a Cluster</a></h6>
<div class="paragraph">
<p>Adding commands to a cluster means that the administrator acknowledges that this cluster can run a given set of
commands. If a command is not linked to a cluster it cannot be used to run a job.</p>
</div>
<div class="paragraph">
<p>The commands are added in priority order. For example say you have different Spark commands you want to add to a given
YARN cluster but you want Genie to treat one as the default. Here is how those commands might be tagged:</p>
</div>
<div class="paragraph">
<p>Spark 1.6.0 (id: spark16)
* <code>type:sparksubmit</code>
* <code>ver:1.6</code>
* <code>ver:1.6.0</code></p>
</div>
<div class="paragraph">
<p>Spark 1.6.1 (id: spark161)
* <code>type:sparksubmit</code>
* <code>ver:1.6.1</code></p>
</div>
<div class="paragraph">
<p>Spark 2.0.0 (id: spark200)
* <code>type:sparksubmit</code>
* <code>ver:2.0</code>
* <code>ver:2.0.0</code></p>
</div>
<div class="paragraph">
<p>Now if we added the commands to the cluster in this order: <code>spark16, spark161, spark200</code> and a user submitted a job
only requesting a command tagged with <code>type:sparksubmit</code> (as in they don&#8217;t care what version just the default) they
would get Spark 1.6.0. However if we later deemed 2.0.0 to be ready to be the default we would reorder the commands to
<code>spark200, spark16, spark161</code> and that same job if submitted again would now run with Spark 2.0.0.</p>
</div>
</div>
<div class="sect5">
<h6 id="_applications_for_a_command"><a class="anchor" href="#_applications_for_a_command"></a><a class="link" href="#_applications_for_a_command">6.2.1.2.2. Applications for a Command</a></h6>
<div class="paragraph">
<p>Linking application(s) to commands means that a command has a dependency on said application(s). The order of the
applications added is important because Genie will setup the applications in that order. Meaning if one application
depends on another (e.g. Spark depends on Hadoop on classpath for YARN mode) Hadoop should be ordered first. All
applications must successfully be installed before Genie will start running the job.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_job_submission"><a class="anchor" href="#_job_submission"></a><a class="link" href="#_job_submission">6.2.2. Job Submission</a></h4>
<div class="paragraph">
<p>The system admin has everything registered and linked together. Things could change but that&#8217;s mostly
transparent to end users, who just want to run jobs. How does that work? This section walks through what
happens at a high level when a job is submitted.</p>
</div>
<div class="sect4">
<h5 id="_cluster_and_command_matching"><a class="anchor" href="#_cluster_and_command_matching"></a><a class="link" href="#_cluster_and_command_matching">6.2.2.1. Cluster and command matching</a></h5>
<div class="paragraph">
<p>In order to submit a job request there is some work a user will have to do up front. What kind of job are they running?
What cluster do they want to run on? What command do they want to use? Do they care about certain details like version
or just want the defaults? Once they determine the answers to the questions they can decide how they want to tag their
job request for the <code>clusterCriterias</code> and <code>commandCriteria</code> fields.</p>
</div>
<div class="paragraph">
<p>General rule of thumb for these fields is to use the lowest common denominator of tags to accomplish what a user
requires. This will allow the most flexibility for the job to be moved to different clusters or commands as need be.
For example if they want to run a Spark job and don&#8217;t really care about version it is better to just say
"type:sparksubmit" (assuming this is tagging structure at your organization) only instead of that <strong>and</strong> "ver:2.0.0".
This way when versions 2.0.1 or 2.1.0 become available, the job moves along with the new default. Obviously if they do
care about version they should set it or any other specific tag.</p>
</div>
<div class="paragraph">
<p>The <code>clusterCriterias</code> field is an array of <code>ClusterCriteria</code> objects. This is done to provide a fallback mechanism.
If no match is found for the first <code>ClusterCriteria</code> and <code>commandCriteria</code> combination it will move onto the second
and so on until all options are exhausted. This is handy if it is desirable to run a job on some cluster that is only
up some of the time but other times it isn&#8217;t and its fine to run it on some other cluster that is always available.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only clusters with status <code>UP</code> and commands with status <code>ACTIVE</code> will be considered during the selection process
all others are ignored.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_cluster_matching_example"><a class="anchor" href="#_cluster_matching_example"></a><a class="link" href="#_cluster_matching_example">6.2.2.1.1. Cluster matching example</a></h6>
<div class="paragraph">
<p>Say the following 3 clusters exists tagged as follows:</p>
</div>
<div class="paragraph">
<p>PrestoTestCluster:
. sched:test
. type:presto
. ver:0.149</p>
</div>
<div class="paragraph">
<p>HadoopProdCluster:
. sched:sla
. type:yarn
. ver:2.7.0
. ver:2.7</p>
</div>
<div class="paragraph">
<p>HadoopTestCluster:
. sched:test
. type:yarn
. ver:2.7.1
. ver:2.7</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Criteria</th>
<th class="tableblock halign-left valign-top">Match</th>
<th class="tableblock halign-left valign-top">Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type:yarn, ver:2.7, sched:sla</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HadoopProdCluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HadoopProdCluster satisfies all criteria</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type:yarn, ver:2.7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HadoopProdCluster or HadoopTestCluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two clusters satisfy the criteria, a choice behavior is unspecified</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type:yarn, ver:2.7.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HadoopTestCluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HadoopTestCluster satisfies all criteria</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type:presto, ver:0.150</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No cluster matches all criteria</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[type:presto, ver:0.150], [type:presto]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PrestoTestCluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first criteria does not match any cluster, so fallback happens to the second, less restrictive criteria
("any presto cluster").</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_user_submits_a_job_request"><a class="anchor" href="#_user_submits_a_job_request"></a><a class="link" href="#_user_submits_a_job_request">6.2.2.2. User Submits a Job Request</a></h5>
<div class="paragraph">
<p>There are other things a user needs to consider when submitting a job. All dependencies which aren&#8217;t sent as attachments
must already be uploaded somewhere Genie can access them. Somewhere like S3, web server, shared disk, etc.</p>
</div>
<div class="paragraph">
<p>Users should familiarize themselves with whatever the <code>executable</code> for their desired command includes. It&#8217;s possible
the system admin has setup some default parameters they should know are there so as to avoid duplication or unexpected
behavior. Also they should make sure they know all the environment variables that may be available to them as part of
the setup process of all the cluster, command and application setup processes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_genie_receives_the_job_request"><a class="anchor" href="#_genie_receives_the_job_request"></a><a class="link" href="#_genie_receives_the_job_request">6.2.2.3. Genie Receives the Job Request</a></h5>
<div class="paragraph">
<p>When Genie receives the job request it does a few things immediately:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the job request doesn&#8217;t have an id it creates a GUID for the job</p>
</li>
<li>
<p>It saves the job request to the database so it is recorded</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the ID is in use a 409 will be returned to the user saying there is a conflict</p>
</li>
</ol>
</div>
</li>
<li>
<p>It creates job and job execution records in data base for consistency</p>
</li>
<li>
<p>It saves any attachments in a temporary location</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Next Genie will attempt to find a cluster and command matching the requested tag combinations. If none is found it will
send a failure back to the user and mark the job failed in the database.</p>
</div>
<div class="paragraph">
<p>If a combination is found Genie will then attempt to determine if the node can run the job. By this it means it will
check the amount of client memory the job requires against the available memory in the Genie allocation. If there is
enough the job will be accepted and will be run on this node and the jobs memory is subtracted from the available pool.
If not it will be rejected with a 503 error message and user should retry later.</p>
</div>
<div class="paragraph">
<p>The amount of memory used by a job is not strictly enforced or even monitored. Such size is determined as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Account for the amount requested in the job request (which must be below an admin-defined threshold)</p>
</li>
<li>
<p>If not provided in the request, use the number provided by the admins for the given command</p>
</li>
<li>
<p>If not provided in the command, use a global default set by the admins</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Successful job submission results in a 202 message to the user stating it&#8217;s accepted and will be processed
asynchronously by the system.</p>
</div>
</div>
<div class="sect4">
<h5 id="_genie_performs_job_setup"><a class="anchor" href="#_genie_performs_job_setup"></a><a class="link" href="#_genie_performs_job_setup">6.2.2.4. Genie Performs Job Setup</a></h5>
<div class="paragraph">
<p>Once a job has been accepted to run on a Genie node, a workflow is executed in order to setup the job working directory
and launch the job. Some minor steps left out for brevity.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Job is marked in <code>INIT</code> state in the database</p>
</li>
<li>
<p>A job directory is created under the admin configured jobs directory with a name of the job id</p>
</li>
<li>
<p>A run script file is created with the name <code>run</code> under the job working directory</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Currently this is a bash script</p>
</li>
</ol>
</div>
</li>
<li>
<p>Kill handlers are added to the run script</p>
</li>
<li>
<p>Directories for Genie logs, application files, command files, cluster files are created under the job working
directory</p>
</li>
<li>
<p>Default environment variables are added to the run script to export their values</p>
</li>
<li>
<p>Cluster configuration files are downloaded and stored in the job work directory</p>
</li>
<li>
<p>Cluster related variables are written into the run script</p>
</li>
<li>
<p>Application configuration and dependency files are downloaded and stored in the job directory if any applications are
needed</p>
</li>
<li>
<p>Application related variables are written into the run script</p>
</li>
<li>
<p>Cluster configuration and dependency files are downloaded and stored in the job directory</p>
</li>
<li>
<p>Command configuration and dependency files are downloaded and stored in the job directory</p>
</li>
<li>
<p>Command related variables are written into the run script</p>
</li>
<li>
<p>All job dependency files (including configurations, dependencies, attachments) are downloaded into the job working directory</p>
</li>
<li>
<p>Job related variables are written into the run script</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_genie_launches_and_monitors_the_job_execution"><a class="anchor" href="#_genie_launches_and_monitors_the_job_execution"></a><a class="link" href="#_genie_launches_and_monitors_the_job_execution">6.2.2.5. Genie Launches and Monitors the Job Execution</a></h5>
<div class="paragraph">
<p>Assuming no errors occurred during the setup, the job is launched.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Job <code>run</code> script is executed in a forked process.</p>
</li>
<li>
<p>Script <code>pid</code> stored in database <code>job_executions</code> table and job marked as <code>RUNNING</code> in database</p>
</li>
<li>
<p>Monitoring process created for pid</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once the job is running Genie will poll the PID periodically waiting for it to no longer be used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Assumption made as to the amount of process churn on the Genie node. We&#8217;re aware PID&#8217;s can be reused but
reasonably this shouldn&#8217;t happen within the poll period given the amount of available PID to the processes a typical
Genie node will run.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the pid no longer exists Genie checks the done file for the exit code. It marks the job succeeded, failed or
killed depending on that code.</p>
</div>
</div>
<div class="sect4">
<h5 id="_genie_performs_job_clean_up"><a class="anchor" href="#_genie_performs_job_clean_up"></a><a class="link" href="#_genie_performs_job_clean_up">6.2.2.6. Genie Performs Job Clean-Up</a></h5>
<div class="paragraph">
<p>To save disk space Genie will delete application, cluster and command dependencies from the job working directory after a job is completed.
This can be disabled by an admin. If the job is marked as it should be archived the working directory will be zipped up
and stored in the default archive location as <code>{jobId}.tar.gz</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_behavior"><a class="anchor" href="#_user_behavior"></a><a class="link" href="#_user_behavior">6.2.3. User Behavior</a></h4>
<div class="paragraph">
<p>Users can check on the status of their job using the <code>status</code> API and get the output using the output APIs. See the
<a href="https://netflix.github.io/genie/docs/4.0.0-SNAPSHOT/rest/">REST Documentation</a> for specifics on how to do that.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wrap_up_2"><a class="anchor" href="#_wrap_up_2"></a><a class="link" href="#_wrap_up_2">6.2.4. Wrap Up</a></h4>
<div class="paragraph">
<p>This section should have helped you understand how Genie works at a high level from configuration all the way to user
job submission and monitoring. The design of Genie is intended to make this process repeatable and reliable for all
users while not hiding any of the details of what is executed at job runtime.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_netflix_example"><a class="anchor" href="#_netflix_example"></a><a class="link" href="#_netflix_example">6.3. Netflix Example</a></h3>
<div class="paragraph">
<p>Understanding Genie without a concrete example is hard. This section attempts to walk through an end to end
configuration and job execution example of a job at Netflix. To see more examples or try your own please see the
<a href="https://netflix.github.io/genie/docs/4.0.0-SNAPSHOT/demo/">Demo Guide</a>. Also see the
<a href="https://netflix.github.io/genie/docs/4.0.0-SNAPSHOT/rest/">REST API</a> documentation which will describe the purpose of the
fields of the resources shown below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This example contains JSON representations of resources.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configuration"><a class="anchor" href="#_configuration"></a><a class="link" href="#_configuration">6.3.1. Configuration</a></h4>
<div class="paragraph">
<p>For the purpose of brevity we will only cover a subset of the total Netflix
configuration.</p>
</div>
<div class="sect4">
<h5 id="_clusters"><a class="anchor" href="#_clusters"></a><a class="link" href="#_clusters">6.3.1.1. Clusters</a></h5>
<div class="paragraph">
<p>At Netflix there are tens of active clusters available at any given time. For this example we&#8217;ll focus on the
production (SLA) and adhoc <a href="http://hadoop.apache.org/">Hadoop</a> YARN clusters and the production
<a href="https://prestodb.io">Presto</a> cluster. For the Hadoop clusters we launch using
<a href="https://aws.amazon.com/emr/">Amazon EMR</a> but it really shouldn&#8217;t matter how clusters are launched provided you can
access the proper <code>*site.xml</code> files.</p>
</div>
<div class="paragraph">
<p>The process of launching a YARN cluster at Netflix involves a set of Python tools which interact with the Amazon and
Genie APIs. First these tools use the EMR APIs to launch the cluster based on configuration files for the cluster
profile. Then the cluster site XML files are uploaded to S3. Once this is complete all the metadata is sent to Genie to
create a cluster resource which you can see examples of below.</p>
</div>
<div class="paragraph">
<p>Presto clusters are launched using <a href="http://www.spinnaker.io/">Spinnaker</a> on regular EC2 instances. As part of the
pipeline the metadata is registered with Genie using the aforementioned Python tools, which in turn leverage the OSS
<a href="https://pypi.python.org/pypi/nflx-genie-client">Genie Python Client</a>.</p>
</div>
<div class="paragraph">
<p>In the following cluster resources you should note the <code>tags</code> applied to each cluster. Remember that the <code>genie.id</code> and
<code>genie.name</code> tags are automatically applied by Genie but all other tags are applied by the admin.</p>
</div>
<div class="paragraph">
<p>For the YARN clusters note that all the configuration files are referenced by their S3 locations. These files are
downloaded into the job working directory at runtime.</p>
</div>
<div class="sect5">
<h6 id="_hadoop_prod_cluster"><a class="anchor" href="#_hadoop_prod_cluster"></a><a class="link" href="#_hadoop_prod_cluster">6.3.1.1.1. Hadoop Prod Cluster</a></h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "bdp_h2prod_20161217_205111",
  "created": "2016-12-17T21:09:30.845Z",
  "updated": "2016-12-20T17:31:32.523Z",
  "tags": [
    "genie.id:bdp_h2prod_20161217_205111",
    "genie.name:h2prod",
    "sched:sla",
    "ver:2.7.2",
    "type:yarn",
    "misc:h2bonus3",
    "misc:h2bonus2",
    "misc:h2bonus1"
  ],
  "version": "2.7.2",
  "user": "dataeng",
  "name": "h2prod",
  "description": null,
  "setupFile": null,
  "configs": [
    "s3://bucket/users/bdp/h2prod/20161217/205111/genie/yarn-site.xml",
    "s3://bucket/users/bdp/h2prod/20161217/205111/genie/mapred-site.xml",
    "s3://bucket/users/bdp/h2prod/20161217/205111/genie/hdfs-site.xml",
    "s3://bucket/users/bdp/h2prod/20161217/205111/genie/core-site.xml"
  ],
  "dependencies": [],
  "status": "UP",
  "_links": {
    "self": {
      "href": "https://genieHost/api/v3/clusters/bdp_h2prod_20161217_205111"
    },
    "commands": {
      "href": "https://genieHost/api/v3/clusters/bdp_h2prod_20161217_205111/commands"
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_hadoop_adhoc_cluster"><a class="anchor" href="#_hadoop_adhoc_cluster"></a><a class="link" href="#_hadoop_adhoc_cluster">6.3.1.1.2. Hadoop Adhoc Cluster</a></h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "bdp_h2query_20161108_204556",
  "created": "2016-11-08T21:07:17.284Z",
  "updated": "2016-12-07T00:51:19.655Z",
  "tags": [
    "sched:adhoc",
    "misc:profiled",
    "ver:2.7.2",
    "sched:sting",
    "type:yarn",
    "genie.name:h2query",
    "genie.id:bdp_h2query_20161108_204556"
  ],
  "version": "2.7.2",
  "user": "dataeng",
  "name": "h2query",
  "description": null,
  "setupFile": "",
  "configs": [
    "s3://bucket/users/bdp/h2query/20161108/204556/genie/core-site.xml",
    "s3://bucket/users/bdp/h2query/20161108/204556/genie/hdfs-site.xml",
    "s3://bucket/users/bdp/h2query/20161108/204556/genie/mapred-site.xml",
    "s3://bucket/users/bdp/h2query/20161108/204556/genie/yarn-site.xml"
  ],
  "dependencies": [],
  "status": "UP",
  "_links": {
    "self": {
      "href": "https://genieHost/api/v3/clusters/bdp_h2query_20161108_204556"
    },
    "commands": {
      "href": "https://genieHost/api/v3/clusters/bdp_h2query_20161108_204556/commands"
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_presto_prod_cluster"><a class="anchor" href="#_presto_prod_cluster"></a><a class="link" href="#_presto_prod_cluster">6.3.1.1.3. Presto Prod Cluster</a></h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "presto-prod-v009",
  "created": "2016-12-05T19:33:52.575Z",
  "updated": "2016-12-05T19:34:14.725Z",
  "tags": [
    "sched:adhoc",
    "genie.id:presto-prod-v009",
    "type:presto",
    "genie.name:presto",
    "ver:0.149",
    "data:prod",
    "type:spinnaker-presto"
  ],
  "version": "1480966454",
  "user": "dataeng",
  "name": "presto",
  "description": null,
  "setupFile": null,
  "configs": [],
  "dependencies": [],
  "status": "UP",
  "_links": {
    "self": {
      "href": "https://genieHost/api/v3/clusters/presto-prod-v009"
    },
    "commands": {
      "href": "https://genieHost/api/v3/clusters/presto-prod-v009/commands"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_commands"><a class="anchor" href="#_commands"></a><a class="link" href="#_commands">6.3.1.2. Commands</a></h5>
<div class="paragraph">
<p>Commands and applications at Netflix are handled a bit differently than clusters. The source data for these command and
application resources are not generated dynamically like the cluster configuration files. Instead they are stored in a
git repository as a combination of YAML, bash, python and other files. These configuration files are synced to an S3
bucket every time a commit occurs. This makes sure Genie is always pulling in the latest configuration. This sync is
performed by a Jenkins job responding to a commit hook trigger. Also done in this Jenkins job is registration of the
commands and applications with Genie via the same python tool set and Genie python client as with clusters.</p>
</div>
<div class="paragraph">
<p>Pay attention to the tags applied to the commands as they are used to select which command to use when a job is run.
The presto command includes a setup file which allows additional configuration when it is used.</p>
</div>
<div class="sect5">
<h6 id="_presto_0_149"><a class="anchor" href="#_presto_0_149"></a><a class="link" href="#_presto_0_149">6.3.1.2.1. Presto 0.149</a></h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "presto0149",
  "created": "2016-08-08T23:22:15.977Z",
  "updated": "2016-12-20T23:28:44.678Z",
  "tags": [
    "genie.id:presto0149",
    "type:presto",
    "genie.name:presto",
    "ver:0.149",
    "data:prod",
    "data:test"
  ],
  "version": "0.149",
  "user": "builds",
  "name": "presto",
  "description": "Presto Command",
  "setupFile": "s3://bucket/builds/bdp-cluster-configs/genie3/commands/presto/0.149/setup.sh",
  "configs": [],
  "dependencies": [],
  "status": "ACTIVE",
  "executable": "${PRESTO_CMD} --server ${PRESTO_SERVER} --catalog hive --schema default --debug",
  "checkDelay": 5000,
  "memory": null,
  "_links": {
    "self": {
      "href": "https://genieHost/api/v3/commands/presto0149"
    },
    "applications": {
      "href": "https://genieHost/api/v3/commands/presto0149/applications"
    },
    "clusters": {
      "href": "https://genieHost/api/v3/commands/presto0149/clusters"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Presto 0.149 Setup File</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash

set -o errexit -o nounset -o pipefail

chmod 755 ${GENIE_APPLICATION_DIR}/presto0149/dependencies/presto-cli
export JAVA_HOME=/apps/bdp-java/java-8-oracle
export PATH=${JAVA_HOME}/bin/:$PATH

export PRESTO_SERVER="http://${GENIE_CLUSTER_NAME}.rest.of.url"
export PRESTO_CMD=${GENIE_APPLICATION_DIR}/presto0149/dependencies/presto-wrapper.py
chmod 755 ${PRESTO_CMD}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_spark_submit_prod_1_6_1"><a class="anchor" href="#_spark_submit_prod_1_6_1"></a><a class="link" href="#_spark_submit_prod_1_6_1">6.3.1.2.2. Spark Submit Prod 1.6.1</a></h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "prodsparksubmit161",
  "created": "2016-05-17T16:38:31.152Z",
  "updated": "2016-12-20T23:28:33.042Z",
  "tags": [
    "genie.id:prodsparksubmit161",
    "genie.name:prodsparksubmit",
    "ver:1.6",
    "type:sparksubmit",
    "data:prod",
    "ver:1.6.1"
  ],
  "version": "1.6.1",
  "user": "builds",
  "name": "prodsparksubmit",
  "description": "Prod Spark Submit Command",
  "setupFile": "s3://bucket/builds/bdp-cluster-configs/genie3/commands/spark/1.6.1/prod/scripts/spark-1.6.1-prod-submit-cmd.sh",
  "configs": [
    "s3://bucket/builds/bdp-cluster-configs/genie3/commands/spark/1.6.1/prod/configs/hive-site.xml"
  ],
  "dependencies": [],
  "status": "ACTIVE",
  "executable": "${SPARK_HOME}/bin/dsespark-submit",
  "checkDelay": 5000,
  "memory": null,
  "_links": {
    "self": {
      "href": "https://genieHost/api/v3/commands/prodsparksubmit161"
    },
    "applications": {
      "href": "https://genieHost/api/v3/commands/prodsparksubmit161/applications"
    },
    "clusters": {
      "href": "https://genieHost/api/v3/commands/prodsparksubmit161/clusters"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spark Submit Prod 1.6.1 Setup File</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash

#set -o errexit -o nounset -o pipefail

export JAVA_HOME=/apps/bdp-java/java-8-oracle

#copy hive-site.xml configuration
cp ${GENIE_COMMAND_DIR}/config/* ${SPARK_CONF_DIR}
cp ${GENIE_COMMAND_DIR}/config/* ${HADOOP_CONF_DIR}/</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_spark_submit_prod_2_0_0"><a class="anchor" href="#_spark_submit_prod_2_0_0"></a><a class="link" href="#_spark_submit_prod_2_0_0">6.3.1.2.3. Spark Submit Prod 2.0.0</a></h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "prodsparksubmit200",
  "created": "2016-10-31T16:59:01.145Z",
  "updated": "2016-12-20T23:28:47.340Z",
  "tags": [
    "ver:2",
    "genie.name:prodsparksubmit",
    "ver:2.0",
    "genie.id:prodsparksubmit200",
    "ver:2.0.0",
    "type:sparksubmit",
    "data:prod"
  ],
  "version": "2.0.0",
  "user": "builds",
  "name": "prodsparksubmit",
  "description": "Prod Spark Submit Command",
  "setupFile": "s3://bucket/builds/bdp-cluster-configs/genie3/commands/spark/2.0.0/prod/copy-config.sh",
  "configs": [
    "s3://bucket/builds/bdp-cluster-configs/genie3/commands/spark/2.0.0/prod/configs/hive-site.xml"
  ],
  "dependencies": [],
  "status": "ACTIVE",
  "executable": "${SPARK_HOME}/bin/dsespark-submit.py",
  "checkDelay": 5000,
  "memory": null,
  "_links": {
    "self": {
      "href": "https://genieHost/api/v3/commands/prodsparksubmit200"
    },
    "applications": {
      "href": "https://genieHost/api/v3/commands/prodsparksubmit200/applications"
    },
    "clusters": {
      "href": "https://genieHost/api/v3/commands/prodsparksubmit200/clusters"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spark Submit 2.0.0 Setup File</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash

set -o errexit -o nounset -o pipefail

# copy hive-site.xml configuration
cp ${GENIE_COMMAND_DIR}/config/* ${SPARK_CONF_DIR}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_applications"><a class="anchor" href="#_applications"></a><a class="link" href="#_applications">6.3.1.3. Applications</a></h5>
<div class="paragraph">
<p>Below are the applications needed by the above commands. The most important part of these applications are the
dependencies and the setup file.</p>
</div>
<div class="paragraph">
<p>The dependencies are effectively the installation package and at Netflix typically are a zip of all binaries needed to
run a client like Hadoop, Hive, Spark etc. Some of these  zips are generated by builds and placed in S3 and others are
downloaded from OSS projects and uploaded to S3 periodically. Often minor changes to these dependencies are needed. A
new file is uploaded to S3 and the Genie caches on each node will be refreshed with this new file on next access. This
pattern allows us to avoid upgrade of Genie clusters every time an application changes.</p>
</div>
<div class="paragraph">
<p>The setup file effectively is the installation script for the aforementioned dependencies. It is sourced by Genie and
the expectation is that after it is run the application is successfully configured in the job working directory.</p>
</div>
<div class="sect5">
<h6 id="_hadoop_2_7_2"><a class="anchor" href="#_hadoop_2_7_2"></a><a class="link" href="#_hadoop_2_7_2">6.3.1.3.1. Hadoop 2.7.2</a></h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "hadoop272",
  "created": "2016-08-18T16:58:31.044Z",
  "updated": "2016-12-21T00:01:08.263Z",
  "tags": [
    "type:hadoop",
    "genie.id:hadoop272",
    "genie.name:hadoop",
    "ver:2.7.2"
  ],
  "version": "2.7.2",
  "user": "builds",
  "name": "hadoop",
  "description": "Hadoop Application",
  "setupFile": "s3://bucket/builds/bdp-cluster-configs/genie3/applications/hadoop/2.7.2/setup.sh",
  "configs": [],
  "dependencies": [
    "s3://bucket/hadoop/2.7.2/hadoop-2.7.2.tgz"
  ],
  "status": "ACTIVE",
  "type": "hadoop",
  "_links": {
    "self": {
      "href": "https://genieHost/api/v3/applications/hadoop272"
    },
    "commands": {
      "href": "https://genieHost/api/v3/applications/hadoop272/commands"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hadoop 2.7.2 Setup File</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash

set -o errexit -o nounset -o pipefail

export JAVA_HOME=/apps/bdp-java/java-7-oracle
export APP_ID=hadoop272
export APP_NAME=hadoop-2.7.2
export HADOOP_DEPENDENCIES_DIR=$GENIE_APPLICATION_DIR/$APP_ID/dependencies
export HADOOP_HOME=$HADOOP_DEPENDENCIES_DIR/$APP_NAME

tar -xf "${HADOOP_DEPENDENCIES_DIR}/hadoop-2.7.2.tgz" -C "${HADOOP_DEPENDENCIES_DIR}"

export HADOOP_CONF_DIR="${HADOOP_HOME}/conf"
export HADOOP_LIBEXEC_DIR="${HADOOP_HOME}/usr/lib/hadoop/libexec"
export HADOOP_HEAPSIZE=1500

cp ${GENIE_CLUSTER_DIR}/config/* $HADOOP_CONF_DIR/

EXTRA_PROPS=$(echo "&lt;property&gt;&lt;name&gt;genie.job.id&lt;/name&gt;&lt;value&gt;$GENIE_JOB_ID&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;genie.job.name&lt;/name&gt;&lt;value&gt;$GENIE_JOB_NAME&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;lipstick.uuid.prop.name&lt;/name&gt;&lt;value&gt;genie.job.id&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;dataoven.job.id&lt;/name&gt;&lt;value&gt;$GENIE_JOB_ID&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;genie.netflix.environment&lt;/name&gt;&lt;value&gt;${NETFLIX_ENVIRONMENT:-prod}&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;genie.version&lt;/name&gt;&lt;value&gt;$GENIE_VERSION&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;genie.netflix.stack&lt;/name&gt;&lt;value&gt;${NETFLIX_STACK:-none}&lt;/value&gt;&lt;/property&gt;" | sed 's/\//\\\//g')

sed -i "/&lt;\/configuration&gt;/ s/.*/${EXTRA_PROPS}&amp;/" $HADOOP_CONF_DIR/core-site.xml

if [ -d "/apps/s3mper/hlib" ]; then
export  HADOOP_OPTS="-javaagent:/apps/s3mper/hlib/aspectjweaver-1.7.3.jar ${HADOOP_OPTS:-}"
fi

# Remove the zip to save space
rm "${HADOOP_DEPENDENCIES_DIR}/hadoop-2.7.2.tgz"</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_presto_0_149_2"><a class="anchor" href="#_presto_0_149_2"></a><a class="link" href="#_presto_0_149_2">6.3.1.3.2. Presto 0.149</a></h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "presto0149",
  "created": "2016-08-08T23:21:58.780Z",
  "updated": "2016-12-21T00:21:10.945Z",
  "tags": [
    "genie.id:presto0149",
    "type:presto",
    "genie.name:presto",
    "ver:0.149"
  ],
  "version": "0.149",
  "user": "builds",
  "name": "presto",
  "description": "Presto Application",
  "setupFile": "s3://bucket/builds/bdp-cluster-configs/genie3/applications/presto/0.149/setup.sh",
  "configs": [],
  "dependencies": [
    "s3://bucket/presto/clients/0.149/presto-cli",
    "s3://bucket/builds/bdp-cluster-configs/genie3/applications/presto/0.149/presto-wrapper.py"
  ],
  "status": "ACTIVE",
  "type": "presto",
  "_links": {
    "self": {
      "href": "https://genieProd/api/v3/applications/presto0149"
    },
    "commands": {
      "href": "https://genieProd/api/v3/applications/presto0149/commands"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Presto 0.149 Setup File</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash

set -o errexit -o nounset -o pipefail

chmod 755 ${GENIE_APPLICATION_DIR}/presto0149/dependencies/presto-cli
chmod 755 ${GENIE_APPLICATION_DIR}/presto0149/dependencies/presto-wrapper.py
export JAVA_HOME=/apps/bdp-java/java-8-oracle
export PATH=${JAVA_HOME}/bin/:$PATH

# Set the cli path for the commands to use when they invoke presto using this Application
export PRESTO_CLI_PATH="${GENIE_APPLICATION_DIR}/presto0149/dependencies/presto-cli"</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_spark_1_6_1"><a class="anchor" href="#_spark_1_6_1"></a><a class="link" href="#_spark_1_6_1">6.3.1.3.3. Spark 1.6.1</a></h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "spark161",
  "created": "2016-05-17T16:32:21.475Z",
  "updated": "2016-12-21T00:01:07.951Z",
  "tags": [
    "genie.id:spark161",
    "type:spark",
    "ver:1.6",
    "ver:1.6.1",
    "genie.name:spark"
  ],
  "version": "1.6.1",
  "user": "builds",
  "name": "spark",
  "description": "Spark Application",
  "setupFile": "s3://bucket/builds/bdp-cluster-configs/genie3/applications/spark/1.6.1/scripts/spark-1.6.1-app.sh",
  "configs": [
    "s3://bucket/builds/bdp-cluster-configs/genie3/applications/spark/1.6.1/configs/spark-env.sh"
  ],
  "dependencies": [
    "s3://bucket/spark/1.6.1/spark-1.6.1.tgz"
  ],
  "status": "ACTIVE",
  "type": "spark",
  "_links": {
    "self": {
      "href": "https://genieHost/api/v3/applications/spark161"
    },
    "commands": {
      "href": "https://genieHost/api/v3/applications/spark161/commands"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spark 1.6.1 Setup File</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash

set -o errexit -o nounset -o pipefail

VERSION="1.6.1"
DEPENDENCY_DOWNLOAD_DIR="${GENIE_APPLICATION_DIR}/spark161/dependencies"

# Unzip all the Spark jars
tar -xf ${DEPENDENCY_DOWNLOAD_DIR}/spark-${VERSION}.tgz -C ${DEPENDENCY_DOWNLOAD_DIR}

# Set the required environment variable.
export SPARK_HOME=${DEPENDENCY_DOWNLOAD_DIR}/spark-${VERSION}
export SPARK_CONF_DIR=${SPARK_HOME}/conf
export SPARK_LOG_DIR=${GENIE_JOB_DIR}
export SPARK_LOG_FILE=spark.log
export SPARK_LOG_FILE_PATH=${GENIE_JOB_DIR}/${SPARK_LOG_FILE}
export CURRENT_JOB_WORKING_DIR=${GENIE_JOB_DIR}
export CURRENT_JOB_TMP_DIR=${CURRENT_JOB_WORKING_DIR}/tmp

export JAVA_HOME=/apps/bdp-java/java-8-oracle
export SPARK_DAEMON_JAVA_OPTS="-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps"

# Make Sure Script is on the Path
export PATH=$PATH:${SPARK_HOME}/bin

# Delete the zip to save space
rm ${DEPENDENCY_DOWNLOAD_DIR}/spark-${VERSION}.tgz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spark 1.6.1 Environment Variable File</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash

#set -o errexit -o nounset -o pipefail
export JAVA_HOME=/apps/bdp-java/java-8-oracle
export SPARK_DAEMON_JAVA_OPTS="-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps"</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_spark_2_0_0"><a class="anchor" href="#_spark_2_0_0"></a><a class="link" href="#_spark_2_0_0">6.3.1.3.4. Spark 2.0.0</a></h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "spark200",
  "created": "2016-10-31T16:58:54.155Z",
  "updated": "2016-12-21T00:01:11.105Z",
  "tags": [
    "type:spark",
    "ver:2.0",
    "ver:2.0.0",
    "genie.id:spark200",
    "genie.name:spark"
  ],
  "version": "2.0.0",
  "user": "builds",
  "name": "spark",
  "description": "Spark Application",
  "setupFile": "s3://bucket/builds/bdp-cluster-configs/genie3/applications/spark/2.0.0/setup.sh",
  "configs": [],
  "dependencies": [
    "s3://bucket/spark-builds/2.0.0/spark-2.0.0.tgz"
  ],
  "status": "ACTIVE",
  "type": "spark",
  "_links": {
    "self": {
      "href": "https://genieHost/api/v3/applications/spark200"
    },
    "commands": {
      "href": "https://genieHost/api/v3/applications/spark200/commands"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spark 2.0.0 Setup File</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash

set -o errexit -o nounset -o pipefail

start_dir=`pwd`
cd `dirname ${BASH_SOURCE[0]}`
SPARK_BASE=`pwd`
cd $start_dir

export JAVA_HOME=/apps/bdp-java/java-8-oracle
export SPARK_DAEMON_JAVA_OPTS="-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps"

SPARK_DEPS=${SPARK_BASE}/dependencies

export SPARK_VERSION="2.0.0"

tar xzf ${SPARK_DEPS}/spark-${SPARK_VERSION}.tgz -C ${SPARK_DEPS}

# Set the required environment variable.
export SPARK_HOME=${SPARK_DEPS}/spark-${SPARK_VERSION}
export SPARK_CONF_DIR=${SPARK_HOME}/conf
export SPARK_LOG_DIR=${GENIE_JOB_DIR}
export SPARK_LOG_FILE=spark.log
export SPARK_LOG_FILE_PATH=${GENIE_JOB_DIR}/${SPARK_LOG_FILE}
export CURRENT_JOB_WORKING_DIR=${GENIE_JOB_DIR}
export CURRENT_JOB_TMP_DIR=${CURRENT_JOB_WORKING_DIR}/tmp

# Make Sure Script is on the Path
export PATH=$PATH:${SPARK_HOME}/bin

# Delete the tarball to save space
rm ${SPARK_DEPS}/spark-${SPARK_VERSION}.tgz

chmod a+x ${SPARK_HOME}/bin/dsespark-submit.py</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_relationships"><a class="anchor" href="#_relationships"></a><a class="link" href="#_relationships">6.3.1.4. Relationships</a></h5>
<div class="paragraph">
<p>Now that all the resources are available they need to be linked together. Commands need to be added to the clusters
they can be run on and applications need to be added as dependencies for commands.</p>
</div>
<div class="sect5">
<h6 id="_commands_for_a_cluster_2"><a class="anchor" href="#_commands_for_a_cluster_2"></a><a class="link" href="#_commands_for_a_cluster_2">6.3.1.4.1. Commands for a Cluster</a></h6>
<div class="paragraph">
<p>When commands are added to a cluster they should be in priority order. Meaning if two commands both match a users tags
for a job the one higher in the list will be used. This allows us to switch defaults quickly and transparently.</p>
</div>
<div class="paragraph">
<p>Note: The lists below leave out a lot of commands and fields for brevity. Only the id of the command is included so it
can reference the same command resource defined earlier in this article.</p>
</div>
<div class="paragraph">
<p><strong>Hadoop Prod Cluster</strong></p>
</div>
<div class="paragraph">
<p>The Hadoop clusters have both currently supported Spark versions added. Spark 1.6.1 is the default but users can
override to Spark 2 using the <code>ver</code> tag.</p>
</div>
<div class="paragraph">
<p>Note: <a href="https://genieHost/api/v3/clusters/bdp_h2prod_20161217_205111/commands" class="bare">https://genieHost/api/v3/clusters/bdp_h2prod_20161217_205111/commands</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  ...
  {
    "id": "prodsparksubmit161"
    ...
  },
  {
    "id": "prodsparksubmit200"
    ...
  }
  ...
]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Hadoop Adhoc Cluster</strong></p>
</div>
<div class="paragraph">
<p>Note: <a href="https://genieHost/api/v3/clusters/bdp_h2query_20161108_204556/commands" class="bare">https://genieHost/api/v3/clusters/bdp_h2query_20161108_204556/commands</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  ...
  {
    "id": "prodsparksubmit161"
    ...
  },
  {
    "id": "prodsparksubmit200"
    ...
  }
  ...
]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Presto Prod Cluster</strong></p>
</div>
<div class="paragraph">
<p>Presto clusters only really support the Presto command but possible that it
could have multiple backwards compatible versions of the client available.</p>
</div>
<div class="paragraph">
<p>Note: <a href="https://genieHost/api/v3/clusters/presto-prod-v009/commands" class="bare">https://genieHost/api/v3/clusters/presto-prod-v009/commands</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  ...
  {
    "id": "presto0149"
    ...
  }
  ...
]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_applications_for_a_command_2"><a class="anchor" href="#_applications_for_a_command_2"></a><a class="link" href="#_applications_for_a_command_2">6.3.1.4.2. Applications for a Command</a></h6>
<div class="paragraph">
<p>Linking applications to a command tells Genie that these applications need to be downloaded and setup in order to
successfully run the command. The order of the applications will be the order the download and setup is performed so
dependencies between applications should be managed via this order.</p>
</div>
<div class="paragraph">
<p><strong>Presto 0.149</strong></p>
</div>
<div class="paragraph">
<p>Presto only needs the corresponding Presto application which contains the Presto Java CLI jar and some setup wrapper
scripts.</p>
</div>
<div class="paragraph">
<p>Note: <a href="https://genieHost/api/v3/commands/presto0149/applications" class="bare">https://genieHost/api/v3/commands/presto0149/applications</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "id": "presto0149"
    ...
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Spark Submit Prod 1.6.1</strong></p>
</div>
<div class="paragraph">
<p>Since we submit Spark jobs to YARN clusters in order to run the Spark submit commands we need both Spark and Hadoop
applications installed and configured on the job classpath in order to run. Hadoop needs to be setup first so that
the configurations can be copied to Spark.</p>
</div>
<div class="paragraph">
<p>Note: <a href="https://genieHost/api/v3/commands/prodsparksubmit161/applications" class="bare">https://genieHost/api/v3/commands/prodsparksubmit161/applications</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "id": "hadoop272"
    ...
  },
  {
    "id": "spark161"
    ...
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Spark Submit Prod 2.0.0</strong></p>
</div>
<div class="paragraph">
<p>Note: <a href="https://genieHost/api/v3/commands/prodsparksubmit200/applications" class="bare">https://genieHost/api/v3/commands/prodsparksubmit200/applications</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "id": "hadoop272"
    ...
  },
  {
    "id": "spark200"
    ...
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_job_submission_2"><a class="anchor" href="#_job_submission_2"></a><a class="link" href="#_job_submission_2">6.3.2. Job Submission</a></h4>
<div class="paragraph">
<p>Everything is now in place for users to submit their jobs. This section will walk through the components and outputs of
that process. For clarity we&#8217;re going to show a PySpark job being submitted to show how Genie figures out the cluster
and command to be used based on what was configured above.</p>
</div>
<div class="sect4">
<h5 id="_the_request"><a class="anchor" href="#_the_request"></a><a class="link" href="#_the_request">6.3.2.1. The Request</a></h5>
<div class="paragraph">
<p>Below is an actual job request (with a few obfuscations) made by a production job here at Netflix to Genie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "SP.CS.FCT_TICKET_0054500815", <i class="conum" data-value="1"></i><b>(1)</b>
  "created": "2016-12-21T04:13:07.244Z",
  "updated": "2016-12-21T04:13:07.244Z",
  "tags": [ <i class="conum" data-value="2"></i><b>(2)</b>
    "submitted.by:call_genie",
    "scheduler.job_name:SP.CS.FCT_TICKET",
    "scheduler.run_id:0054500815",
    "SparkPythonJob",
    "scheduler.name:uc4"
  ],
  "version": "NA",
  "user": "someNetflixEmployee",
  "name": "SP.CS.FCT_TICKET",
  "description": "{\"username\": \"root\", \"host\": \"2d35f0d397fd\", \"client\": \"nflx-kragle-djinn/0.4.3\", \"kragle_version\": \"0.41.11\", \"job_class\": \"SparkPythonJob\"}",
  "setupFile": null,
  "commandArgs": "--queue root.sla --py-files dea_pyspark_core-latest.egg fct_ticket.py", <i class="conum" data-value="3"></i><b>(3)</b>
  "clusterCriterias": [ <i class="conum" data-value="4"></i><b>(4)</b>
    {
      "tags": [
        "sched:sla"
      ]
    }
  ],
  "commandCriteria": [ <i class="conum" data-value="5"></i><b>(5)</b>
    "type:sparksubmit",
    "data:prod"
  ],
  "group": null,
  "disableLogArchival": false,
  "email": null,
  "cpu": null,
  "memory": null,
  "timeout": null,
  "configs": [],
  "dependencies": [ <i class="conum" data-value="6"></i><b>(6)</b>
    "s3://bucket/DSE/etl_code/cs/ticket/fct_ticket.py",
    "s3://bucket/dea/pyspark_core/dea_pyspark_core-latest.egg"
  ],
  "applications": [],
  "_links": {
    "self": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/request"
    },
    "job": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815"
    },
    "execution": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/execution"
    },
    "output": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/output"
    },
    "status": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/status"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lets look at a few of the fields of note:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The user set the ID. This is a popular pattern in Netflix for tracking jobs between systems and reattaching to jobs.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The user added a few tags that will allow them to search for the job later. This is optional but convenient.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The user specifies some arguments to add to the default set of command arguments specified by the command
<code>executable</code> field. In this case it&#8217;s what python file to run.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The user wants this job to run on any cluster that is labeled as having an SLA which also supports the command
selected using the <code>commandCriteria</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>User wants the default Spark Submit command (no version specified) and wants to be able to access production data</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Here you can see that they add the two files referenced in the <code>commandArgs</code> as dependencies. These files will be
downloaded in the root job directory parallel to the run script so they are accessible.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_the_job"><a class="anchor" href="#_the_job"></a><a class="link" href="#_the_job">6.3.2.2. <strong>The Job</strong></a></h5>
<div class="paragraph">
<p>In this case the job was accepted by Genie for processing. Below is the actual job object containing fields the user
might care about. Some are copied from the initial request (like tags) and some are added by Genie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "SP.CS.FCT_TICKET_0054500815",
  "created": "2016-12-21T04:13:07.245Z",
  "updated": "2016-12-21T04:20:35.801Z",
  "tags": [
    "submitted.by:call_genie",
    "scheduler.job_name:SP.CS.FCT_TICKET",
    "scheduler.run_id:0054500815",
    "SparkPythonJob",
    "scheduler.name:uc4"
  ],
  "version": "NA",
  "user": "someNetflixEmployee",
  "name": "SP.CS.FCT_TICKET",
  "description": "{\"username\": \"root\", \"host\": \"2d35f0d397fd\", \"client\": \"nflx-kragle-djinn/0.4.3\", \"kragle_version\": \"0.41.11\", \"job_class\": \"SparkPythonJob\"}",
  "status": "SUCCEEDED", <i class="conum" data-value="1"></i><b>(1)</b>
  "statusMsg": "Job finished successfully.", <i class="conum" data-value="2"></i><b>(2)</b>
  "started": "2016-12-21T04:13:09.025Z", <i class="conum" data-value="3"></i><b>(3)</b>
  "finished": "2016-12-21T04:20:35.794Z", <i class="conum" data-value="4"></i><b>(4)</b>
  "archiveLocation": "s3://bucket/genie/main/logs/SP.CS.FCT_TICKET_0054500815.tar.gz", <i class="conum" data-value="5"></i><b>(5)</b>
  "clusterName": "h2prod", <i class="conum" data-value="6"></i><b>(6)</b>
  "commandName": "prodsparksubmit", <i class="conum" data-value="7"></i><b>(7)</b>
  "runtime": "PT7M26.769S", <i class="conum" data-value="8"></i><b>(8)</b>
  "commandArgs": "--queue root.sla --py-files dea_pyspark_core-latest.egg fct_ticket.py",
  "_links": {
    "self": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815"
    },
    "output": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/output"
    },
    "request": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/request"
    },
    "execution": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/execution"
    },
    "status": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/status"
    },
    "cluster": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/cluster"
    },
    "command": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/command"
    },
    "applications": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/applications"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some fields of note:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The current status of the job. Since this sample was taken after the job was completed it&#8217;s already marked
SUCCESSFUL</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This job was successful but if it failed for some reason a more human readable reason would be found here</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The time this job was forked from the Genie process</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The time Genie recognized the job as complete</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Where Genie uploaded a zip of the job directory after the job was completed</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The name of the cluster where this job ran and is de-normalized from the cluster record at the time</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The name of the command used to run this job which is de-normalized from the command record at the time</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The total run time in ISO8601</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_cluster_selection"><a class="anchor" href="#_cluster_selection"></a><a class="link" href="#_cluster_selection">6.3.2.2.1. Cluster Selection</a></h6>
<div class="paragraph">
<p>Because the user submitted with <code>sched:sla</code> this limits the clusters it can run on to any with that tag applied. In our
example case only the cluster with ID <code>bdp_h2prod_20161217_205111</code> has this tag. This isn&#8217;t enough to make sure this
job can run (there also needs to be a matching command). If there had been multiple sla clusters Genie would consider
them all equal and randomly select one.</p>
</div>
</div>
<div class="sect5">
<h6 id="_command_selection"><a class="anchor" href="#_command_selection"></a><a class="link" href="#_command_selection">6.3.2.2.2. Command Selection</a></h6>
<div class="paragraph">
<p>The command criteria states that this job needs to run on a SLA cluster that supports a command of type
<code>prodsparksubmit</code> that can access <code>prod</code> data. Two commands (<code>prodsparksubmit161</code> and <code>prodsparksubmit200</code>) match this
criteria. Both are linked to the cluster <code>bdp_h2prod_20161217_205111</code>. Since both match Genie selects the "default" one
which is the first on in the list. In this case it was <code>prodsparksubmit161</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_job_execution"><a class="anchor" href="#_the_job_execution"></a><a class="link" href="#_the_job_execution">6.3.2.3. The Job Execution</a></h5>
<div class="paragraph">
<p>Below is the job execution resource. This is mainly for system and admin use but it can have some useful information
for users as well. Mainly it shows which Genie node it actually ran on, how much memory it was allocated, how
frequently the system polled it for status and when it would have timed out had it kept running.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "id": "SP.CS.FCT_TICKET_0054500815",
  "created": "2016-12-21T04:13:07.245Z",
  "updated": "2016-12-21T04:20:35.801Z",
  "hostName": "a.host.com",
  "processId": 68937,
  "checkDelay": 5000,
  "timeout": "2016-12-28T04:13:09.016Z",
  "exitCode": 0,
  "memory": 1536,
  "_links": {
    "self": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/execution"
    },
    "job": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815"
    },
    "request": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/request"
    },
    "output": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/output"
    },
    "status": {
      "href": "https://genieHost/api/v3/jobs/SP.CS.FCT_TICKET_0054500815/status"
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_job_output"><a class="anchor" href="#_job_output"></a><a class="link" href="#_job_output">6.3.2.4. Job Output</a></h5>
<div class="paragraph">
<p>Below is an image of the root of the job output directory (displayed via Genie UI) for the above job. Note that the
dependency files are all downloaded there and some standard files are available (run, stdout, stderr).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The URI&#8217;s in this section point to the UI output endpoint however they are also available via the REST API and
the UI is really calling this REST API to get the necessary information. Showing the UI endpoints for the better
looking output and because most users will see this version.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output" class="bare">https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Click image for full size
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://netflix.github.io/genie/images/3.0.0/output.png"><img src="https://netflix.github.io/genie/images/3.0.0/output.png" alt="Genie Output Directory"></a>
</div>
</div>
<div class="sect5">
<h6 id="_the_run_script"><a class="anchor" href="#_the_run_script"></a><a class="link" href="#_the_run_script">6.3.2.4.1. The Run Script</a></h6>
<div class="paragraph">
<p>Clicking into the run script shows the below contents. This run script is generated specifically for each individual
job by Genie. It has some standard bits (error checking, exit process) but also specific information like environment
variables and what to actually run. Everything is specific to the job working directory. In particular note all the
<code>GENIE_*</code> environment variable exports. These can be used when building your setup and configuration scripts to be more
flexible.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output/run" class="bare">https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output/run</a>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/usr/bin/env bash

set -o nounset -o pipefail

# Set function in case any of the exports or source commands cause an error
trap "handle_failure" ERR EXIT

function handle_failure {
  ERROR_CODE=$?
  # Good exit
  if [[ ${ERROR_CODE} -eq 0 ]]; then
  exit 0
  fi
  # Bad exit
  printf '{"exitCode": "%s"}\n' "${ERROR_CODE}" &gt; ./genie/genie.done
  exit "${ERROR_CODE}"
}

# Set function for handling kill signal from the job kill service
trap "handle_kill_request" SIGTERM

function handle_kill_request {

  KILL_EXIT_CODE=999
  # Disable SIGTERM signal for the script itself
  trap "" SIGTERM

  echo "Kill signal received"

  ### Write the kill exit code to genie.done file as exit code before doing anything else
  echo "Generate done file with exit code ${KILL_EXIT_CODE}"
  printf '{"exitCode": "%s"}\n' "${KILL_EXIT_CODE}" &gt; ./genie/genie.done

  ### Send a kill signal the entire process group
  echo "Sending a kill signal to the process group"
  pkill -g $$

  COUNTER=0
  NUM_CHILD_PROCESSES=`pgrep -g ${SELF_PID} | wc -w`

  # Waiting for 30 seconds for the child processes to die
  while [[  $COUNTER -lt 30 ]] &amp;&amp; [[ "$NUM_CHILD_PROCESSES" -gt 3 ]]; do
    echo The counter is $COUNTER
    let COUNTER=COUNTER+1
    echo "Sleeping now for 1 seconds"
    sleep 1
    NUM_CHILD_PROCESSES=`pgrep -g ${SELF_PID} | wc -w`
  done

  # check if any children are still running. If not just exit.
  if [ "$NUM_CHILD_PROCESSES" -eq 3  ]
  then
    echo "Done"
    exit
  fi

  ### Reaching at this point means the children did not die. If so send kill -9 to the entire process group
  # this is a hard kill and will this process itself as well
  echo "Sending a kill -9 to children"

  pkill -9 -g $$
  echo "Done"
}

SELF_PID=$$

echo Start: `date '+%Y-%m-%d %H:%M:%S'`

export GENIE_JOB_DIR="/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815"

export GENIE_APPLICATION_DIR="${GENIE_JOB_DIR}/genie/applications"

export GENIE_COMMAND_DIR="${GENIE_JOB_DIR}/genie/command/prodsparksubmit161"

export GENIE_COMMAND_ID="prodsparksubmit161"

export GENIE_COMMAND_NAME="prodsparksubmit"

export GENIE_CLUSTER_DIR="${GENIE_JOB_DIR}/genie/cluster/bdp_h2prod_20161217_205111"

export GENIE_CLUSTER_ID="bdp_h2prod_20161217_205111"

export GENIE_CLUSTER_NAME="h2prod"

export GENIE_JOB_ID="SP.CS.FCT_TICKET_0054500815"

export GENIE_JOB_NAME="SP.CS.FCT_TICKET"

export GENIE_JOB_MEMORY=1536

export GENIE_VERSION=3

# Sourcing setup file from Application: hadoop272
source ${GENIE_JOB_DIR}/genie/applications/hadoop272/setup.sh

# Sourcing setup file from Application: spark161
source ${GENIE_JOB_DIR}/genie/applications/spark161/spark-1.6.1-app.sh

# Sourcing setup file from Command: prodsparksubmit161
source ${GENIE_JOB_DIR}/genie/command/prodsparksubmit161/spark-1.6.1-prod-submit-cmd.sh

# Dump the environment to a env.log file
env | sort &gt; ${GENIE_JOB_DIR}/genie/logs/env.log

# Kick off the command in background mode and wait for it using its pid
${SPARK_HOME}/bin/dsespark-submit --queue root.sla --py-files dea_pyspark_core-latest.egg fct_ticket.py &gt; stdout 2&gt; stderr &amp;
wait $!

# Write the return code from the command in the done file.
printf '{"exitCode": "%s"}\n' "$?" &gt; ./genie/genie.done
echo End: `date '+%Y-%m-%d %H:%M:%S'`</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_genie_dir"><a class="anchor" href="#_genie_dir"></a><a class="link" href="#_genie_dir">6.3.2.4.2. Genie Dir</a></h6>
<div class="paragraph">
<p>Inside the output directory there is a <code>genie</code> directory. This directory is where Genie stores all the downloaded
dependencies and any logs. Everything outside this directory is intended to be user generated other than the run
script. Some commands or applications may put their logs in the root directory as well if desired (like spark or hive
logs).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output/genie" class="bare">https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output/genie</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Click image for full size
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://netflix.github.io/genie/images/3.0.0/genie-dir.png"><img src="https://netflix.github.io/genie/images/3.0.0/genie-dir.png" alt="Genie Directory"></a>
</div>
</div>
<div class="paragraph">
<p>Genie system logs go into the logs directory.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output/genie/logs" class="bare">https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output/genie/logs</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Click image for full size
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://netflix.github.io/genie/images/3.0.0/genie-logs.png"><img src="https://netflix.github.io/genie/images/3.0.0/genie-logs.png" alt="Genie Logs Directory"></a>
</div>
</div>
<div class="paragraph">
<p>Of interest in here is the env dump file. This is convenient for debugging jobs. You can see all the environment
variables that were available right before Genie executed the final command to run the job in the run script.</p>
</div>
<div class="paragraph">
<p>You can see this file generated in the run script above on this line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Dump the environment to a env.log file
env | sort &gt; ${GENIE_JOB_DIR}/genie/logs/env.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>The contents of this file will look something like the below</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output/genie/logs/env.log" class="bare">https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output/genie/logs/env.log</a>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">APP_ID=hadoop272
APP_NAME=hadoop-2.7.2
CURRENT_JOB_TMP_DIR=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815/tmp
CURRENT_JOB_WORKING_DIR=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815
EC2_AVAILABILITY_ZONE=us-east-1d
EC2_REGION=us-east-1
GENIE_APPLICATION_DIR=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815/genie/applications
GENIE_CLUSTER_DIR=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815/genie/cluster/bdp_h2prod_20161217_205111
GENIE_CLUSTER_ID=bdp_h2prod_20161217_205111
GENIE_CLUSTER_NAME=h2prod
GENIE_COMMAND_DIR=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815/genie/command/prodsparksubmit161
GENIE_COMMAND_ID=prodsparksubmit161
GENIE_COMMAND_NAME=prodsparksubmit
GENIE_JOB_DIR=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815
GENIE_JOB_ID=SP.CS.FCT_TICKET_0054500815
GENIE_JOB_MEMORY=1536
GENIE_JOB_NAME=SP.CS.FCT_TICKET
GENIE_VERSION=3
HADOOP_CONF_DIR=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815/genie/applications/hadoop272/dependencies/hadoop-2.7.2/conf
HADOOP_DEPENDENCIES_DIR=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815/genie/applications/hadoop272/dependencies
HADOOP_HEAPSIZE=1500
HADOOP_HOME=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815/genie/applications/hadoop272/dependencies/hadoop-2.7.2
HADOOP_LIBEXEC_DIR=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815/genie/applications/hadoop272/dependencies/hadoop-2.7.2/usr/lib/hadoop/libexec
HOME=/home/someNetflixUser
JAVA_HOME=/apps/bdp-java/java-8-oracle
LANG=en_US.UTF-8
LOGNAME=someNetflixUser
MAIL=/var/mail/someNetflixUser
NETFLIX_ENVIRONMENT=prod
NETFLIX_STACK=main
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin:/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815/genie/applications/spark161/dependencies/spark-1.6.1/bin
PWD=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815
SHELL=/bin/bash
SHLVL=1
SPARK_CONF_DIR=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815/genie/applications/spark161/dependencies/spark-1.6.1/conf
SPARK_DAEMON_JAVA_OPTS=-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps
SPARK_HOME=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815/genie/applications/spark161/dependencies/spark-1.6.1
SPARK_LOG_DIR=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815
SPARK_LOG_FILE_PATH=/mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815/spark.log
SPARK_LOG_FILE=spark.log
SUDO_COMMAND=/usr/bin/setsid /mnt/genie/jobs/SP.CS.FCT_TICKET_0054500815/run
SUDO_GID=60243
SUDO_UID=60004
SUDO_USER=genie
TERM=unknown
TZ=GMT
USER=someNetflixUser
USERNAME=someNetflixUser
_=/usr/bin/env</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally inside the applications folder you can see the applications that were downloaded and configured.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output/genie/applications/hadoop272/dependencies/hadoop-2.7.2" class="bare">https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output/genie/applications/hadoop272/dependencies/hadoop-2.7.2</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Click image for full size
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://netflix.github.io/genie/images/3.0.0/hadoop-application.png"><img src="https://netflix.github.io/genie/images/3.0.0/hadoop-application.png" alt="Hadoop App Contents"></a>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output/genie/applications/spark161/dependencies/spark-1.6.1" class="bare">https://genieHost/output/SP.CS.FCT_TICKET_0054500815/output/genie/applications/spark161/dependencies/spark-1.6.1</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Click image for full size
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://netflix.github.io/genie/images/3.0.0/spark-application.png"><img src="https://netflix.github.io/genie/images/3.0.0/spark-application.png" alt="Hadoop App Contents"></a>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wrap_up_3"><a class="anchor" href="#_wrap_up_3"></a><a class="link" href="#_wrap_up_3">6.3.3. Wrap Up</a></h4>
<div class="paragraph">
<p>This section went over how Genie is configured by admins at Netflix and how how users submit
jobs and retrieve their logs and output. Anyone is free to configure Genie however suits their needs in terms of
tags and applications which are downloaded vs installed already on a Genie node but this method works for us here at
Netflix.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_netflix_deployment"><a class="anchor" href="#_netflix_deployment"></a><a class="link" href="#_netflix_deployment">6.4. Netflix Deployment</a></h3>
<div class="paragraph">
<p>Many people ask how Genie is deployed at Netflix on AWS. This section tries to explain at a high level the components
used and how Genie integrates into the environment. Below is a diagram of how deployment looks at Netflix.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://netflix.github.io/genie/images/3.0.0/deployment.png"><img src="https://netflix.github.io/genie/images/3.0.0/deployment.png" alt="Netflix Deployment"></a>
</div>
<div class="title">Figure 1. Genie Netflix Deployment</div>
</div>
<div class="sect3">
<h4 id="_components"><a class="anchor" href="#_components"></a><a class="link" href="#_components">6.4.1. Components</a></h4>
<div class="paragraph">
<p>Brief descriptions of all the components.</p>
</div>
<div class="sect4">
<h5 id="_elastic_load_balancer"><a class="anchor" href="#_elastic_load_balancer"></a><a class="link" href="#_elastic_load_balancer">6.4.1.1. Elastic Load Balancer</a></h5>
<div class="paragraph">
<p>The <a href="https://aws.amazon.com/elasticloadbalancing/">Elastic Load Balancer</a> (ELB) is used for a few purposes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Allow a single endpoint for all API calls</p>
</li>
<li>
<p>Distribute API calls amongst all Genie nodes in an ASG</p>
</li>
<li>
<p>Allow HTTPS termination at single point</p>
</li>
<li>
<p>Allow human friendly DNS name to be assigned via <a href="https://aws.amazon.com/route53/">Route 53</a> entry</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_auto_scaling_group_asg"><a class="anchor" href="#_auto_scaling_group_asg"></a><a class="link" href="#_auto_scaling_group_asg">6.4.1.2. Auto Scaling Group (ASG)</a></h5>
<div class="paragraph">
<p>A cluster of Genie nodes. Each <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html">AMI</a> contains an Apache
HTTP server fronting Tomcat 8 via <a href="http://tomcat.apache.org/connectors-doc/index.html">AJP</a>.</p>
</div>
<div class="paragraph">
<p>Currently the Genie ASG is a fleet of <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/i2-instances.html">i2.4xl</a>
instances. The primary production ASG sizes about thirty instances at any given time. Each Genie instance is configured
to be allocated 80% of the available system memory for jobs. Tomcat itself is given 10 GB. Leaving the rest for the
system and other processes.</p>
</div>
<div class="paragraph">
<p>The ASG is set to auto scale when the average amount of used job memory, that 80% of the system memory, exceeds 60% of
the available.</p>
</div>
<div class="paragraph">
<p>For example an i2.4xl image has 122 GB of available memory. For simplicity we allocate 100 GB for jobs. If the average
memory used for jobs per node across the ASG exceeds 60 GB for some period of time we will scale the cluster up by
one node to allocate resources before we get in trouble.</p>
</div>
<div class="paragraph">
<p>Currently we don&#8217;t auto scale down but from time to time we take a look to see if a new ASG needs to be launched at a
smaller size.</p>
</div>
</div>
<div class="sect4">
<h5 id="_relational_database_rds"><a class="anchor" href="#_relational_database_rds"></a><a class="link" href="#_relational_database_rds">6.4.1.3. Relational Database (RDS)</a></h5>
<div class="paragraph">
<p>We currently use an <a href="https://aws.amazon.com/rds/aurora/">Amazon Aurora</a> cluster on db.r3.4xl instances. Aurora is MySQL
compatible so we use the standard MySQL JDBC driver that is packaged with Genie to talk to the database. We deploy to
a Multi-AZ cluster and we have a reader endpoint that we use for reporting and backup.</p>
</div>
</div>
<div class="sect4">
<h5 id="_zookeeper"><a class="anchor" href="#_zookeeper"></a><a class="link" href="#_zookeeper">6.4.1.4. Zookeeper</a></h5>
<div class="paragraph">
<p>We use an <a href="https://zookeeper.apache.org/">Apache Zookeeper</a> cluster which is deployed and managed by another team within
Netflix for leadership election within our Genie ASG. When the Genie ASG comes up it (using Spring Cloud Cluster) looks
in Zookeeper to see if there already is a leader for the app/cluster/stack combination. If there isn&#8217;t it elects a new
one.</p>
</div>
<div class="paragraph">
<p>The leader is not involved in serving incoming requests, it performs background cleanup task for the entire cluster.</p>
</div>
</div>
<div class="sect4">
<h5 id="_elasticache"><a class="anchor" href="#_elasticache"></a><a class="link" href="#_elasticache">6.4.1.5. ElastiCache</a></h5>
<div class="paragraph">
<p>We use <a href="https://aws.amazon.com/elasticache/">AWS ElastiCache</a> to provide a Redis cluster to store our HTTP sessions (via
<a href="http://projects.spring.io/spring-session/">Spring Session</a>). This allows us to have the users only sign in via SAML one
time and not have to do it every time the ELB routes them to a new host for the UI.</p>
</div>
</div>
<div class="sect4">
<h5 id="_security_configuration"><a class="anchor" href="#_security_configuration"></a><a class="link" href="#_security_configuration">6.4.1.6. Security Configuration</a></h5>
<div class="paragraph">
<p>Internally Genie is secured via OAuth2 (for APIs) and SAML (for UI). We integrate with a Ping Federate IDP service to
provide authentication and authorization information.</p>
</div>
<div class="paragraph">
<p>HTTPS is enabled to the ELB via a Verisign signed certificate tied to the Route 53 DNS address.</p>
</div>
<div class="paragraph">
<p>See <a href="#_security">Security</a> for more information.</p>
</div>
</div>
<div class="sect4">
<h5 id="_spinnaker"><a class="anchor" href="#_spinnaker"></a><a class="link" href="#_spinnaker">6.4.1.7. Spinnaker</a></h5>
<div class="paragraph">
<p>Genie is deployed using <a href="http://www.spinnaker.io/">Spinnaker</a>. We currently have a few stacks (prod, test, dev, load,
stage, etc) that we use for different purposes. Spinnaker handles all this for us after we configure the pipelines.
See the Spinnaker site for more information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wrap_up_4"><a class="anchor" href="#_wrap_up_4"></a><a class="link" href="#_wrap_up_4">6.4.2. Wrap Up</a></h4>
<div class="paragraph">
<p>This section focused on how Genie is deployed within Netflix. Hopefully it helps bring clarity to a way that Genie can
be deployed. Genie certainly is not limited to this deployment model and you are free to come up with your own this
should only serve as a template or example.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_security"><a class="anchor" href="#_security"></a><a class="link" href="#_security">6.5. Security</a></h3>
<div class="paragraph">
<p>A long requested feature for Genie has been adding authentication and authorization support for the UI and particularly
the REST APIs. Genie 3 development allowed the time and resources to finally implement a solution. Genie security is
built on top of <a href="https://projects.spring.io/spring-security/">Spring Security</a> which allows the specific security
solution to be plugged in based on user requirements.</p>
</div>
<div class="sect3">
<h4 id="_architecture"><a class="anchor" href="#_architecture"></a><a class="link" href="#_architecture">6.5.1. Architecture</a></h4>
<div class="paragraph">
<p>Out of the box Genie supports securing the REST APIs via OAuth2 and/or x509 certificates and the UI via SAML. Below is
an image of how this security architecture works within Netflix.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://netflix.github.io/genie/images/3.0.0/security.png"><img src="https://netflix.github.io/genie/images/3.0.0/security.png" alt="Genie Security Architecture"></a>
</div>
<div class="title">Figure 2. Genie Security Architecture</div>
</div>
<div class="paragraph">
<p>At a high level you can see that the requests are passed through several security filter chains before they arrive at
the Genie application code. Based on the URL being accessed different filter chains will be triggered. If the request
can be authenticated and authorized the security configuration is stored within the Spring Security Context which can
then be accessed via Genie code if necessary.</p>
</div>
<div class="paragraph">
<p>All the security can be enabled or disabled as desired by system administrators. You can find the various properties
under <code>genie.security.*</code> in the <a href="#_properties">Properties</a> section. Spring specific properties are also involved but the enabling
and disabling is done via the <code>genie.security</code> properties.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rest_api_security"><a class="anchor" href="#_rest_api_security"></a><a class="link" href="#_rest_api_security">6.5.2. REST API Security</a></h4>
<div class="paragraph">
<p>The REST APIs described in the <a href="https://netflix.github.io/genie/releases/4.0.0-SNAPSHOT/rest/">REST documentation</a> can be
secured via OAuth2 and/or x509 out of the box. Both these mechanisms secure everything under <code>/api/*</code> to require a user
be authenticated to access them. All <code>job</code> and read (e.g. GET) APIs are available to any authenticated user when
security is enabled. If security is enabled users will need to be granted an <code>admin</code> role in order to use the
configuration APIs for <code>applications</code>, <code>commands</code> and <code>clusters</code>. By configuration APIs we mean anything that will
modify the state of these resources like the POST, PUT, PATCH, DELETE APIs.</p>
</div>
<div class="sect4">
<h5 id="_x509"><a class="anchor" href="#_x509"></a><a class="link" href="#_x509">6.5.2.1. x509</a></h5>
<div class="paragraph">
<p>If x509 is enabled it will be checked first (before the OAuth2 filter chain if that is enabled) and if a valid
certificate is present in the request the user will be authenticated and granted the pertinent role.</p>
</div>
<div class="paragraph">
<p>For this to work out of the box the certicates must be formatted so that the <code>principle</code> field contains a colon
separated string of format <code>{user}:{role1,role2&#8230;&#8203;}</code>. This is how Genie will determine the user and roles that user
will be granted within the system.</p>
</div>
</div>
<div class="sect4">
<h5 id="_oauth2"><a class="anchor" href="#_oauth2"></a><a class="link" href="#_oauth2">6.5.2.2. OAuth2</a></h5>
<div class="paragraph">
<p><a href="https://oauth.net/2/">OAuth2</a> security is implemented via the
<a href="https://projects.spring.io/spring-security-oauth/">Spring Security OAuth</a> project. You can read documentation there but
out of the box support has been extended to include Ping Federate as a provider. This is used within Netflix and there
are two ways you can have Genie validate tokens. One is if the Bearer token is merely and identifier you can have
Genie call the Ping Federate server to validate the Bearer token is valid. The other is to configure Ping Federate to
generated <a href="https://jwt.io/">JWT</a> tokens and all validation can be done within the Genie node. This is the preferrable
option as you save processing time and unnecessary IO.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ui_security"><a class="anchor" href="#_ui_security"></a><a class="link" href="#_ui_security">6.5.3. UI Security</a></h4>
<div class="paragraph">
<p>The UI and other endpoints can be secured using SAML via <a href="https://projects.spring.io/spring-security-saml/">Spring SAML</a>.
You can configure Genie where to look in the SAML assertion to parse out user and role information. If only SAML
security is turned on users won&#8217;t need to authenticate in order to access the APIs. If SAML and one of the REST API
security methods is enabled and configured if a user authenticates to the UI via SAML they will also be able to access
the REST APIs within the same HTTP session without aquiring a token or passing a certificate.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wrap_up_5"><a class="anchor" href="#_wrap_up_5"></a><a class="link" href="#_wrap_up_5">6.5.4. Wrap Up</a></h4>
<div class="paragraph">
<p>This section is meant to provide a high level overview of how Genie supports authentication and authorization out of
the box if configured properly. Security is a very large topic and to truly understand how this works reading into
the various libraries and technologies mentioned in this section is recommended.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_features_5"><a class="anchor" href="#_features_5"></a><a class="link" href="#_features_5">7. Features</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section has documentation pertaining to specific features of Genie that may need specific examples.</p>
</div>
<div class="sect2">
<h3 id="_cluster_load_balancing"><a class="anchor" href="#_cluster_load_balancing"></a><a class="link" href="#_cluster_load_balancing">7.1. Cluster Load Balancing</a></h3>
<div class="paragraph">
<p>Genie allows administrators to tag clusters with multiple tags that could reflect any type of domain modeling the
admins wish to accomplish. Purpose of the cluster, types of data the cluster can access, workload expected are just
some examples of ways tags could be used to classify clusters. Users submit jobs with a series of tags that help
Genie identify which cluster to run a job on. Sometimes the tags submitted by the job match multiple clusters. At this
point Genie needs a mechanism to chose a final runtime target from the set of clusters selected. This is where the
cluster load balancing feature of Genie comes into play.</p>
</div>
<div class="paragraph">
<p>Genie has an interface <code>ClusterLoadBalancer</code> which can be implemented to provide plugin functionality of algorithms for
cluster selection. The interface has a single method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/**
 * Return best cluster to run job on.
 *
 * @param clusters   An immutable, non-empty list of available clusters to choose from
 * @param jobRequest The job request these clusters are being load balanced for
 * @return the "best" cluster to run job on or null if no cluster selected
 * @throws GenieException if there is any error
 */
@Nullable
Cluster selectCluster(final List&lt;Cluster&gt; clusters, final JobRequest jobRequest) throws GenieException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>At startup Genie will collect all beans that implement the <code>ClusterLoadBalancer</code> interface and based on their order
store them in an invocation order list. Meaning that when multiple clusters are selected from the database based on tags
Genie will send the list of clusters to the implementations in preference order until one of them returns the cluster to
use.</p>
</div>
<div class="paragraph">
<p>Genie currently ships with two implementations of this interface which are described below.</p>
</div>
<div class="sect3">
<h4 id="_randomizedclusterloadbalancerimpl"><a class="anchor" href="#_randomizedclusterloadbalancerimpl"></a><a class="link" href="#_randomizedclusterloadbalancerimpl">7.1.1. RandomizedClusterLoadBalancerImpl</a></h4>
<div class="paragraph">
<p>As the name indicates this load balancer simply uses a random number generator to select a cluster from the list by
index. There is no intelligence to this load balancer algorithm but it does provide very close to an equal distribution
between clusters if the same tags are always used.</p>
</div>
<div class="paragraph">
<p>This implementation is the "default" implementation. It has the lowest priority order so if all other active
implementations fail to select a cluster this implementation will be invoked and chose randomly.</p>
</div>
</div>
<div class="sect3">
<h4 id="_scriptloadbalancer"><a class="anchor" href="#_scriptloadbalancer"></a><a class="link" href="#_scriptloadbalancer">7.1.2. ScriptLoadBalancer</a></h4>
<div class="paragraph">
<p>This implementation, first introduced in 3.1.0, allows administrators to provide a script to be invoked at runtime to
decide which cluster to select. Currently <code>JavaScript</code> and <code>Groovy</code> are supported out of the box but others (like
<code>Python</code>, <code>Ruby</code>, etc) could be supported by adding their implementations of the
<a href="https://docs.oracle.com/javase/8/docs/api/javax/script/ScriptEngine.html">ScriptEngine</a> interface to the Genie classpath.</p>
</div>
<div class="sect4">
<h5 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a><a class="link" href="#_configuration_2">7.1.2.1. Configuration</a></h5>
<div class="paragraph">
<p>The script load balancer is disabled by default. To enable it an admin must set the property
<code>genie.jobs.clusters.load-balancers.script.enabled</code> to true.</p>
</div>
<div class="paragraph">
<p>Other properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.load-balancers.script.destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location on disk where the script source file should be stored after it is downloaded from
<code>genie.jobs.clusters.loadBalancers.script.source</code>. The file will be given the same name.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="file:///tmp/genie/loadbalancers/script/destination/" class="bare">file:///tmp/genie/loadbalancers/script/destination/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.load-balancers.script.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the script based load balancer should be enabled for the system or not.
See also: <code>genie.jobs.clusters.loadBalancers.script.source</code>
See also: <code>genie.jobs.clusters.loadBalancers.script.destination</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.load-balancers.script.refreshRate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How frequently to refresh the load balancer script (in milliseconds)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.load-balancers.script.source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the script the load balancer should load to evaluate which cluster to use for a job request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="file:///tmp/genie/loadBalancers/script/source/loadBalance.js" class="bare">file:///tmp/genie/loadBalancers/script/source/loadBalance.js</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.load-balancers.script.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time (in milliseconds) that the system will attempt to run the cluster load balancer script before it
forces a timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_script_contract"><a class="anchor" href="#_script_contract"></a><a class="link" href="#_script_contract">7.1.2.2. Script Contract</a></h5>
<div class="paragraph">
<p>The contract between the script and the Java code is as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Script Inputs</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non-empty JSON array of cluster objects (serialized as a string) of the clusters to be evaluated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobRequest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON object (serialized as a string) of the job request that kicked off this evaluation</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Script Output</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Result</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the cluster selected by the script algorithm that should be used to run the job</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No cluster was selected and the evaluation should fall back to another cluster load balancing algorithm</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For most of the script engines the last statement will be the return value.</p>
</div>
</div>
<div class="sect4">
<h5 id="_script_examples"><a class="anchor" href="#_script_examples"></a><a class="link" href="#_script_examples">7.1.2.3. Script Examples</a></h5>
<div class="paragraph">
<p>Some simple script examples</p>
</div>
<div class="sect5">
<h6 id="_javascript"><a class="anchor" href="#_javascript"></a><a class="link" href="#_javascript">7.1.2.3.1. Javascript</a></h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">var cJson = JSON.parse(clusters);
var jJson = JSON.parse(jobRequest);

var index;
for (index = 0; index &lt; cJson.length; index++) {
    var cluster = cJson[index];
    if (cluster.user === "h") {
        break;
    }
}

index &lt; cJson.length ? cJson[index].id : null;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_groovy"><a class="anchor" href="#_groovy"></a><a class="link" href="#_groovy">7.1.2.3.2. Groovy</a></h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import groovy.json.JsonSlurper

def jsonSlurper = new JsonSlurper()
def cJson = jsonSlurper.parseText(clusters)
def jJson = jsonSlurper.parseText(jobRequest)

def index = cJson.findIndexOf {
    cluster -&gt; cluster.user == "h"
}

index == -1 ? null : cJson[index].id</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_caveats_2"><a class="anchor" href="#_caveats_2"></a><a class="link" href="#_caveats_2">7.1.2.4. Caveats</a></h5>
<div class="paragraph">
<p>The script load balancer provides great flexibility for system administrators to test algorithms for cluster load
balancing at runtime. Since the script is refreshed periodically it can even be changed after Genie is running. With
this flexibility comes the trade off that script evaluation is going to be slower than code running direct JVM byte
code. The load balancer tries to offset this by compiling and caching the script code in between refresh invocations. It
is recommended that once an algorithm is well tested it be converted to a true implementation of the
<code>ClusterLoadBalancer</code> interface if performance is desired.</p>
</div>
<div class="paragraph">
<p>Additionally if a script error is made the <code>ScriptLoadBalancer</code> will swallow the exceptions and simply return <code>null</code>
from all calls to <code>selectCluster</code> until the script is fixed and <code>refresh</code> is invoked again. The metric
<code>genie.jobs.clusters.load-balancers.script.select.timer</code> with tag <code>status</code> and value <code>failed</code> can be used to monitor
this situation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wrap_up_6"><a class="anchor" href="#_wrap_up_6"></a><a class="link" href="#_wrap_up_6">7.1.3. Wrap Up</a></h4>
<div class="paragraph">
<p>This section went over the cluster load balancing feature of Genie. This interface provides an extension point for
administrators of Genie to tweak Genie&#8217;s runtime behavior to suit their needs.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation"><a class="anchor" href="#_installation"></a><a class="link" href="#_installation">8. Installation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Installing Genie is easy. You can run Genie either as a standalone application with an embedded Tomcat or by deploying
the WAR file to an existing Tomcat or other servlet container. There are trade-offs to these two methods as will be
discussed below.</p>
</div>
<div class="sect2">
<h3 id="_standalone_jar"><a class="anchor" href="#_standalone_jar"></a><a class="link" href="#_standalone_jar">8.1. Standalone Jar</a></h3>
<div class="paragraph">
<p>The
<a href="http://oss.jfrog.org/libs-snapshot/com/netflix/genie/genie-app/4.0.0-SNAPSHOT/">standalone jar</a>
is the simplest to deploy as it has no other real moving parts. Just
put the jar somewhere on a system and execute <code>java -jar genie-app-4.0.0-SNAPSHOT.jar</code>. The downside is it&#8217;s a little
harder to configure or add jars to the classpath if you want them.</p>
</div>
<div class="paragraph">
<p>Configuration (application*.yml or application*.properties) files can be loaded from the current working directory or
from a <code>.genie/</code> directory stored in the users home directory (e.g. <code>~/.genie/application.yml</code>). Classpath items (jars,
.jks files, etc) can be added to <code>~/.genie/lib/</code> and they will be part of the application classpath.</p>
</div>
<div class="paragraph">
<p>Properties can be passed in on the command line two ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>java -Dgenie.example.property blah -jar genie-app-4.0.0-SNAPSHOT.jar</code></p>
</li>
<li>
<p><code>java -jar genie-app-4.0.0-SNAPSHOT.jar --genie.example.property=blah</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Property resolution goes in this order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Command line</p>
</li>
<li>
<p>Classpath profile specific configuration files (e.g. application-prod.yml)</p>
</li>
<li>
<p>Embedded profile specific configuration files</p>
</li>
<li>
<p>Classpath default configuration file (e.g. application.yml)</p>
</li>
<li>
<p>Embedded default configuration file</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more details see the
<a href="http://docs.spring.io/spring-boot/docs/2.1.2.RELEASE/reference/htmlsingle/#boot-features-external-config">Spring Boot</a>
documentation on external configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tomcat_deployment"><a class="anchor" href="#_tomcat_deployment"></a><a class="link" href="#_tomcat_deployment">8.2. Tomcat Deployment</a></h3>
<div class="paragraph">
<p>The WAR deployment requires the
<a href="http://oss.jfrog.org/libs-snapshot/com/netflix/genie/genie-war/4.0.0-SNAPSHOT/">WAR file</a>
be placed in an existing Tomcat or servlet
container. At Netflix we use this method as we have existing tuning of Tomcat and a lot of infrastructure in place
for monitoring of the Tomcat process. We deploy to Tomcat 8.x and rename the WAR file to ROOT.war so that the
application context root is <code>/</code>.</p>
</div>
<div class="paragraph">
<p>The benefits of deploying to Tomcat are you have more access to the internals of the application and can change
property files directly or add classpath items to either the Tomcat classpath or in the actual Genie lib directory.</p>
</div>
<div class="paragraph">
<p>The drawback is that you now also have to tune and configure Tomcat or your chosen servlet container in addition to
Genie and it may be more overhead than you&#8217;re comfortable with.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_3"><a class="anchor" href="#_configuration_3"></a><a class="link" href="#_configuration_3">8.3. Configuration</a></h3>
<div class="paragraph">
<p>Genie has a lot of available configuration options. For descriptions of specific properties you can see the
<a href="#_properties">Properties</a> section below. Additionally if you want to know how to configure more parts of the application you
should have a look at the <a href="http://docs.spring.io/spring-boot/docs/2.1.2.RELEASE/reference/htmlsingle/">Spring Boot</a>
docs as they will go in depth on how to configure the various Spring components used in Genie.</p>
</div>
<div class="sect3">
<h4 id="_profiles"><a class="anchor" href="#_profiles"></a><a class="link" href="#_profiles">8.3.1. Profiles</a></h4>
<div class="paragraph">
<p>Spring provides a mechanism of segregating parts of application configuration and activating them in certain
conditions. This mechanism is known as
<a href="http://docs.spring.io/spring-boot/docs/2.1.2.RELEASE/reference/htmlsingle/#boot-features-profiles">profiles</a>. By
default Genie will run with the <code>dev</code> profile activated. This means that all the properties in <code>application-dev.yml</code>
will be appended to, or overwrite, the properties in <code>application.yml</code> which are the defaults. Changing the active
profiles is easy you just need to change the property <code>spring.profiles.active</code> and pass in a comma separated list of
active profiles. For example <code>--spring.profiles.active=prod,cloud</code> would activate the prod and cloud profiles.</p>
</div>
<div class="paragraph">
<p>Properties for specific profiles should be stored in files named <code>application-{profileName}.yml</code>. You can make as many
as you want but Genie ships with <code>dev</code>, <code>s3</code> and <code>prod</code> profiles properties already included. Their properties can be
seen in the <a href="#_properties">Properties</a> section below.</p>
</div>
</div>
<div class="sect3">
<h4 id="_database"><a class="anchor" href="#_database"></a><a class="link" href="#_database">8.3.2. Database</a></h4>
<div class="paragraph">
<p>By default since Genie will launch with the <code>dev</code> profile active it will launch with an in memory database running as
part of its process. This means when you shut Genie down all data will be lost. It is meant for development only. Genie
ships with JDBC drivers for <code>MySql</code>, <code>PostgreSQL</code> and <code>H2</code>. If you want to use a different database you should load
the JDBC driver jar file somewhere on the Genie classpath.</p>
</div>
<div class="paragraph">
<p>For production you should probably enable the <code>prod</code> profile which creates a connection pool for the database and then
override the properties <code>spring.datasource.url</code>, <code>spring.datasource.username</code> and <code>spring.datasource.password</code> to match
your environment. The datasource url needs to be a valid JDBC connection string for your database. You can see examples
<a href="http://www.java2s.com/Tutorial/Java/0340__Database/AListofJDBCDriversconnectionstringdrivername.htm">here</a> or
<a href="http://alvinalexander.com/java/jdbc-connection-string-mysql-postgresql-sqlserver">here</a> or search for your database
and JDBC connection string on your search engine of choice.</p>
</div>
<div class="paragraph">
<p>Genie also ships with database schema scripts for MySQL and PostgreSQL. You will need to load these into your database
before you run Genie if you use one of these databases. Genie no longer creates the schema dynamically for performance
reasons. Follow the below sections to load the schemas into your table.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Genie 3.2.0+ software is not compatible with previous database schema. Before upgrading existing Genie servers to
3.2.0, follow the steps below to perform database upgrade, or create a new database with 3.1.x schema. Database upgrades
beyond 3.2.0 are handled automatically by the Genie binary via <a href="https://flywaydb.org/">Flyway</a>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_mysql"><a class="anchor" href="#_mysql"></a><a class="link" href="#_mysql">8.3.2.1. MySQL</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This assumes the MySQL client binaries are installed
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Genie requires MySQL 5.6.3+ due to certain properties not existing before that version
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ensure the following properties are set in your <code>my.cnf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">[mysqld]
innodb_file_per_table=ON
innodb_large_prefix=ON
innodb_file_format=barracuda</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Restart MySQL if you&#8217;ve changed these properties
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql -u {username} -p{password} -h {host} -e 'create database genie;'</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_3_1_x_to_3_2_0_database_upgrade"><a class="anchor" href="#_3_1_x_to_3_2_0_database_upgrade"></a><a class="link" href="#_3_1_x_to_3_2_0_database_upgrade">8.3.2.1.1. 3.1.x to 3.2.0 database upgrade</a></h6>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Genie requires MySQL 5.6.3+ due to certain properties not existing before that version
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have an existing Genie installation on a database version &lt; 3.2.0 you&#8217;ll need to upgrade your schema to
3.2.0 before continuing.</p>
</div>
<div class="paragraph">
<p>Download the:
<a href="https://github.com/Netflix/genie/blob/master/genie-ddl/src/main/sql/mysql/upgrade-3.1.x-to-3.2.0.mysql.sql">3.1.x to 3.2.0 Schema Upgrade</a>.</p>
</div>
<div class="paragraph">
<p>Ensure the following properties are set in your <code>my.cnf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">[mysqld]
innodb_file_per_table=ON
innodb_large_prefix=ON
innodb_file_format=barracuda</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Restart MySQL if you&#8217;ve changed these properties
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql -u {username} -p{password} -h {host} genie &lt; upgrade-3.1.x-to-3.2.0.mysql.sql</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_postgresql"><a class="anchor" href="#_postgresql"></a><a class="link" href="#_postgresql">8.3.2.2. PostgreSQL</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This assumes the PSQL binaries are installed
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">createdb genie</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_3_1_x_to_3_2_0_database_upgrade_2"><a class="anchor" href="#_3_1_x_to_3_2_0_database_upgrade_2"></a><a class="link" href="#_3_1_x_to_3_2_0_database_upgrade_2">8.3.2.2.1. 3.1.x to 3.2.0 database upgrade</a></h6>
<div class="paragraph">
<p>If you have an existing Genie installation on a database version &lt; 3.2.0 you&#8217;ll need to upgrade your schema to
3.2.0 before continuing.</p>
</div>
<div class="paragraph">
<p>Download the
<a href="https://github.com/Netflix/genie/blob/master/genie-ddl/src/main/sql/postgresql/upgrade-3.1.x-to-3.2.0.postgresql.sql">3.1.x to 3.2.0 Schema Upgrade</a>.</p>
</div>
<div class="paragraph">
<p>Then run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">psql -U {user} -h {host} -d genie -f upgrade-3.1.x-to-3.2.0.postgresql.sql</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_local_directories"><a class="anchor" href="#_local_directories"></a><a class="link" href="#_local_directories">8.3.3. Local Directories</a></h4>
<div class="paragraph">
<p>Genie requires a few directories to run. By default Genie will place them under <code>/tmp</code> however in production you should
probably create a larger directory you can store the job working directories and other places in. These correspond to
the <code>genie.jobs.locations.*</code> properties described below in the <a href="#_properties">Properties</a> section.</p>
</div>
<div class="sect4">
<h5 id="_s3"><a class="anchor" href="#_s3"></a><a class="link" href="#_s3">8.3.3.1. S3</a></h5>
<div class="paragraph">
<p>If your commands, applications, or jobs depend on artifacts referenced via S3 URI, you will need to configure the S3
subsystem. If you&#8217;re not assuming a role there is nothing you necessarily have to do provided a default credentials
provider chain can be created. See
<a href="https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/auth/DefaultAWSCredentialsProviderChain.html">here</a>
for the rules for that.</p>
</div>
<div class="paragraph">
<p>If you need to assume a order to access Amazon resources from your Genie node set the property
<code>genie.aws.credentials.role</code> to the ARN of the role you&#8217;d like to assume. This will force Genie to create a
<a href="https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/auth/STSAssumeRoleSessionCredentialsProvider.html">STSAssumeRoleSessionCredentialsProvider</a>
instead of the default one.</p>
</div>
<div class="paragraph">
<p>Example role setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>genie:
  aws:
    credentials:
      role: &lt;AWS ROLE ARN&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wrap_up_7"><a class="anchor" href="#_wrap_up_7"></a><a class="link" href="#_wrap_up_7">8.4. Wrap Up</a></h3>
<div class="paragraph">
<p>This section contains the basic setup instructions for Genie. There are other components that can be added to the
system like Redis, Zookeeper and Security systems that are somewhat outside the scope of an initial setup. You can see
the <a href="#_properties">Properties</a> section below for the properties you&#8217;d need to configure for these systems.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_properties"><a class="anchor" href="#_properties"></a><a class="link" href="#_properties">9. Properties</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the various properties that can be set to control the behavior of your Genie node and cluster.
For more information on Spring properties you should see the
<a href="http://docs.spring.io/spring-boot/docs/2.1.2.RELEASE/reference/htmlsingle/">Spring Boot</a> reference documentation
and the <a href="http://cloud.spring.io/spring-cloud-static/Greenwich.RELEASE/">Spring Cloud</a> documentation.
The Spring properties described here are ones that we have overridden from Spring defaults.</p>
</div>
<div class="sect2">
<h3 id="_default_properties"><a class="anchor" href="#_default_properties"></a><a class="link" href="#_default_properties">9.1. Default Properties</a></h3>
<div class="sect3">
<h4 id="_genie_properties"><a class="anchor" href="#_genie_properties"></a><a class="link" href="#_genie_properties">9.1.1. Genie Properties</a></h4>
<div class="paragraph">
<p>Properties marked 'dynamic' reflect change of property value in the environment happening at runtime.
Whereas static properties values are bound during application startup and do not change after the application is up and running.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Dynamic</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.aws.s3.buckets.[bucketName].roleARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For the bucket with name <code>bucketName</code> the ARN of the role to assume to read/write to that bucket. If a bucket is used
that isn&#8217;t listed in this map the default credentials configured will be used</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.aws.s3.buckets.[bucketName].region</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The AWS region the bucket with <code>bucketName</code> is in. Clients to talk to this bucket will be created in this region. If
no value is specified the bucket is assumed to be in the same region as the Genie process.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.agent.filter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, enables the built-in agent filter service. The filter behavior is controlled by other active <code>genie.agent.filter.*</code> properties.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.agent.filter.version.minimum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum version an agent needs to be (e.g., <code>1.2.3</code>) in order to communicate with this server. The filter needs to be enabled for this to take effect.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.agent.filter.version.blacklist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A regex matched against agent version (e.g., <code>1\.2\..*</code>), matching agents are rejected. The filter needs to be enabled for this to take effect.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.agent.filter.version.whitelist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A regex matched against agent version (e.g., <code>1\.2\..*</code>), agents not matching are rejected. The filter needs to be enabled for this to take effect.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.aws.credentials.role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The AWS role ARN to assume when connecting to S3. If this is set Genie will create a credentials provider that will
attempt to assume this role on the host Genie is running on</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.file.cache.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to store cached files on local disk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="file:///tmp/genie/cache" class="bare">file:///tmp/genie/cache</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.grpc.server.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to start the gRPC server and services during server startup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.grpc.server.services.job-file-sync.ackIntervalMilliseconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How many milliseconds to wait between checks whether some acknowledgement should be sent to the agent regardless of
whether the <code>maxSyncMessages</code> threshold has been reached or not</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30,000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.grpc.server.services.job-file-sync.maxSyncMessages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How many messages to receive from the agent before an acknowledgement message is sent back from the server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.health.maxCpuLoadConsecutiveOccurrences</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the threshold of consecutive occurrences of CPU load crossing the &lt;maxCpuLoadPercent&gt;.
Health of the system is marked unhealthy if the CPU load of a system goes beyond the threshold 'maxCpuLoadPercent'
for 'maxCpuLoadConsecutiveOccurrences' consecutive times.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.health.maxCpuLoadPercent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the threshold for the maximum CPU load percentage to consider for an instance to be unhealthy.
Health of the system is marked unhealthy if the CPU load of a system goes beyond this threshold for
'maxCpuLoadConsecutiveOccurrences' consecutive times.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.http.connect.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of milliseconds before HTTP calls between Genie nodes should time out on connection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.http.read.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of milliseconds before HTTP calls between Genie nodes should time out on attempting to read data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.cleanup.deleteDependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not to delete the dependencies directories for applications, cluster, command to save disk space after job completion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.load-balancers.script.destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location on disk where the script source file should be stored after it is downloaded from
<code>genie.jobs.clusters.load-balancers.script.source</code>. The file will be given the same name.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="file:///tmp/genie/loadbalancers/script/destination/" class="bare">file:///tmp/genie/loadbalancers/script/destination/</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.load-balancers.script.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the script based load balancer should be enabled for the system or not.
See also: <code>genie.jobs.clusters.load-balancers.script.source</code>
See also: <code>genie.jobs.clusters.load-balancers.script.destination</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.load-balancers.script.refreshRate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How frequently to refresh the load balancer script (in milliseconds)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.load-balancers.script.source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the script the load balancer should load to evaluate which cluster to use for a job request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="file:///tmp/genie/loadBalancers/script/source/loadBalance.js" class="bare">file:///tmp/genie/loadBalancers/script/source/loadBalance.js</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.clusters.load-balancers.script.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time (in milliseconds) that the system will attempt to run the cluster load balancer script before it
forces a timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.forwarding.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not to attempt to forward kill and get output requests for jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.forwarding.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port to forward requests to as it could be different than ELB port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.forwarding.scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The connection protocol to use (http or https)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.locations.archives</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default root location where job archives should be stored. Scheme should be included. Created if doesn&#8217;t exist.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="file:///tmp/genie/archives/" class="bare">file:///tmp/genie/archives/</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.locations.attachments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default root location where job attachments will be temporarily stored. Scheme should be included. Created if
doesn&#8217;t exist.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="file:///tmp/genie/attachments/" class="bare">file:///tmp/genie/attachments/</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.locations.jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default root location where job working directories will be placed. Created by system if doesn&#8217;t exist.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="file:///tmp/genie/jobs/" class="bare">file:///tmp/genie/jobs/</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.max.stdOutSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of bytes the job standard output file can grow to before Genie will kill the job</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8589934592</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.max.stdErrSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of bytes the job standard error file can grow to before Genie will kill the job</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8589934592</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.memory.maxSystemMemory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The total number of MB out of the system memory that Genie can use for running jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30720</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.memory.defaultJobMemory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The total number of megabytes Genie will assume a job is allocated if not overridden by a command or user at runtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.memory.maxJobMemory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum amount of memory, in megabytes, that a job client can be allocated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10240</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.users.creationEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether Genie should attempt to create a system user in order to run the job as or not. Genie user must have sudo
rights for this to work.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.users.runAsUserEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether Genie should run the jobs as the user who submitted the job or not. Genie user must have sudo rights for this
to work.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.active-limit.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the per-user active job limit. The number of jobs is controlled by the <code>genie.jobs.users.active-limit.count</code> property.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.active-limit.count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of active jobs a user is allowed to have. Once a user hits this limit, jobs submitted are rejected. This is property is ignored unless <code>genie.jobs.users.active-limit.enabled</code> is set to true. This limit applies to users that don&#8217;t have an override set via <code>genie.jobs.users.active-limit.overrides.&lt;user-name&gt;</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.active-limit.overrides.&lt;user-name&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of active jobs that user 'user-name' is allowed to have. This is property is ignored unless <code>genie.jobs.users.active-limit.enabled</code> is set to true.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.completion-check-back-off.min-interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum time between checks for job completion in milliseconds. Must be greater than zero.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.completion-check-back-off.max-interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum time between checks for job completion in milliseconds. This is a fallback value, the value used in most cases is specified as part of the <code>Command</code> entity for a particular job.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.jobs.completion-check-back-off.factor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplication factor that grows the delay between checks for job completions. Must be greater than 1.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.leader.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether this node should be the leader of the cluster or not. Should only be used if leadership is not being
determined by Zookeeper or other mechanism via Spring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.mail.fromAddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The e-mail address that should be used as the from address when alert emails are sent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:no-reply-genie@geniehost.com">no-reply-genie@geniehost.com</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.mail.user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The user to log into the e-mail server with</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.mail.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the e-mail server</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.redis.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable storage of HTTP sessions inside Redis via <a href="http://projects.spring.io/spring-session/">Spring Session</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.retry.initialInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time to wait after initial failure before retrying the first time in milliseconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.retry.maxInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum amount of time to wait between retries for the final retry in the back-off policy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.retry.noOfRetries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of times to retry requests to before failure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.retry.s3.noOfRetries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of times to retry requests to S3 before failure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.oauth2.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable oauth2 based security or not for REST APIs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.oauth2.pingfederate.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether Ping Federate is being used as the OAuth2 server and Genie should assume default configuration for its tokens</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.oauth2.pingfederate.jwt.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to assume that the bearer tokens coming with API requests are <a href="https://jwt.io/">JWT</a> tokens or not</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.oauth2.pingfederate.jwt.keyValue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The public key used to verify the JWT signature</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether SAML security should be turned on to protect access to the user interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.attributes.user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key in the SAML assertion to get the user name from</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.attributes.groups.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key in the SAML assertion to get group information for the user from</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.attributes.groups.admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The group a user needs to be a member of in order to be granted an admin role</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.idp.serviceProviderMetadataUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL where metadata for Genie service SAML configuration can be pulled from</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.keystore.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the keystore file on the classpath for SAML assertions</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.keystore.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for opening the keystore</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.keystore.defaultKey.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the default key to use for signing the SAML request</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.keystore.defaultKey.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password to open the default key</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.loadBalancer.contextPath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The context path for Genie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.loadBalancer.includeServerPortInRequestURL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not to include the port of the load balancer in the redirect request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.loadBalancer.scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The scheme the load balancer Genie cluster is run behind uses (http or https). Used for SAML post back</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.loadBalancer.serverName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root context for the Genie load balancer e.g. genie.prod.com</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.loadBalancer.serverPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port the load balancer is listening on. Used for SAML post back</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.sp.entityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id that Genie is identified by in the identity provider</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.saml.sp.entityBaseURL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the SAML assertion should be posted back to. e.g. <a href="https://genie.prod.com" class="bare">https://genie.prod.com</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.security.x509.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable x509 certificate security on the REST APIs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.swagger.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable <a href="http://swagger.io/">Swagger</a> to be bootstrapped into the Genie service so that the endpoint
/swagger-ui.html shows API documentation generated by the swagger specification</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.cluster-checker.healthIndicatorsToIgnore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The health indicator groups from the actuator /health endpoint to ignore when determining if a node is lost or not as
a comma separated list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory,genieMemory,discoveryComposite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.cluster-checker.lostThreshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of times a Genie nodes need to fail health check in order for jobs running on that node to be marked as
lost and failed by the Genie leader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.cluster-checker.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port to connect to other Genie nodes on</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.cluster-checker.rate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of milliseconds to wait between health checks to other Genie nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.cluster-checker.scheme</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The scheme (http or https) for connecting to other Genie nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.database-cleanup.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not to delete old and unused records from the database at a scheduled interval.
See: <code>genie.tasks.database-cleanup.expression</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.database-cleanup.maxDeletedPerTransaction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of job records (across multiple tables) to delete from the database
 in a single transaction. Genie will loop and perform multiple transactions until
 all jobs older than the retention time are deleted.
 This is a soft limit, it could be rounded up to the next multiple of page size.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.database-cleanup.pageSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page size used within each cleanup transaction to iterate through the job records</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.database-cleanup.expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cron expression for how often to run the database cleanup task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 0 0 * * *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.database-cleanup.retention</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of days to retain jobs in the database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.database-cleanup.skipJobsCleanup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip the Jobs table when performing database cleanup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.database-cleanup.skipClustersCleanup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip the Clusters table when performing database cleanup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.database-cleanup.skipFilesCleanup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip the Files table when performing database cleanup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.database-cleanup.skipTagsCleanup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip the Tags table when performing database cleanup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.disk-cleanup.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not to remove old job directories on the Genie node or not</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.disk-cleanup.expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often to run the disk cleanup task as a cron expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 0 0 * * *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.disk-cleanup.retention</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of days to leave old job directories on disk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.executor.pool.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of executor threads available for tasks to be run on within the node in an adhoc manner. Best to set to the
number of CPU cores x 2 + 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.tasks.scheduler.pool.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of available threads for the scheduler to use to run tasks on the node at scheduled intervals. Best to set
to the number of CPU cores x 2 + 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.zookeeper.leader.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The namespace to use for Genie leadership election of a given cluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/genie/leader/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie.s3filetransfer.strictUrlCheckEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to strictly check an S3 URL for illegal characters before attempting to use it</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_spring_properties"><a class="anchor" href="#_spring_properties"></a><a class="link" href="#_spring_properties">9.1.2. Spring Properties</a></h4>
<div class="paragraph">
<p><a href="http://docs.spring.io/spring-boot/docs/2.1.2.RELEASE/reference/htmlsingle/#common-application-properties">Spring Properties</a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">info.genie.version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Genie version to be displayed by the UI and returned by the actuator /info endpoint. Set by the build.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current build version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">management.endpoints.web.base-path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default base path for the Spring Actuator[<a href="https://docs.spring.io/spring-boot/docs/current/actuator-api/html/" class="bare">https://docs.spring.io/spring-boot/docs/current/actuator-api/html/</a>]
management endpoints. Switched from default <code>/actuator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.oauth2.client.client-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the OAuth2 client</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.oauth2.client.client-secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The secret for the oauth2 client</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.oauth2.resource.filter-order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The order the OAuth2 resource filter is places within the spring security chain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.oauth2.resource.id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id of the resource server</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.oauth2.resource.token-info-uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI where to get token information from</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.application.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the application in the Spring context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.banner.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Banner file location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie-banner.txt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.data.redis.repositories.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether Spring data repositories should attempt to be created for Redis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDBC URL of the database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:h2:mem:genie</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username for the datasource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database password</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.auto-commit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to auto commit transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.connection-test-query</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query to use to check if connections are ok</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select 0;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.leak-detection-threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How long to wait (in milliseconds) before a connection should be considered leaked out of the pool if it hasn&#8217;t been
returned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.maximum-pool-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum connection pool size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.minimum-idle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fewest allowed idle connections</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.pool-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the connection pool. Will show up in logs under this name.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">genie-hikari-db-pool</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.flyway.baselineDescription</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description for the initial baseline of a database instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base Version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.flyway.baselineOnMigrate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not to baseline when Flyway is present and the datasource targets a DB that isn&#8217;t managed by Flyway</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.flyway.baselineVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial DB version (When Genie migrated to Flyway is current setting. Shouldn&#8217;t touch)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.flyway.locations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where flyway should look for database migration files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath:db/migration/{vendor}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.jackson.serialization.write-dates-as-timestamps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to serialize instants as timestamps or ISO8601 strings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.jackson.time-zone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time zone used when formatting dates. For instance <code>America/Los_Angeles</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UTC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.jpa.hibernate.ddl-auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DDL mode. This is actually a shortcut for the "hibernate.hbm2ddl.auto" property.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">validate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.jpa.hibernate.properties.hibernate.jdbc.time_zone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The timezone to use when writing dates to the database
<a href="https://moelholm.com/2016/11/09/spring-boot-controlling-timezones-with-hibernate/">see article</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UTC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.profiles.active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default active profiles when Genie is run</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dev</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.mail.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hostname of the mail server</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.mail.testConnection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to check the connection to the mail server on startup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.redis.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endpoint for the Redis cluster used to store HTTP session information</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.servlet.multipart.max-file-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max attachment file size. Values can use the suffixed "MB" or "KB" to indicate a Megabyte or Kilobyte size.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.servlet.multipart.max-request-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max job request size. Values can use the suffixed "MB" or "KB" to indicate a Megabyte or Kilobyte size.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.session.store-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The back end storage system for Spring to store HTTP session information. See
<a href="http://docs.spring.io/spring-boot/docs/2.1.2.RELEASE/reference/htmlsingle/#boot-features-session">Spring Boot Session</a>
for more information. Currently on classpath only none, redis and jdbc will work.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_spring_cloud_properties"><a class="anchor" href="#_spring_cloud_properties"></a><a class="link" href="#_spring_cloud_properties">9.1.3. Spring Cloud Properties</a></h4>
<div class="paragraph">
<p>Properties set by default to manipulate various <a href="https://projects.spring.io/spring-cloud/">Spring Cloud</a> libraries.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.credentials.useDefaultAwsCredentialsChain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to attempt creation of a standard AWS credentials chain.
See <a href="https://cloud.spring.io/spring-cloud-aws/">Spring Cloud AWS</a> for more information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.region.auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the AWS region will be attempted to be auto recognized via the AWS metadata services on EC2.
See <a href="https://cloud.spring.io/spring-cloud-aws/">Spring Cloud AWS</a> for more information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.region.static</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default AWS region. See <a href="https://cloud.spring.io/spring-cloud-aws/">Spring Cloud AWS</a> for more information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">us-east-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud.aws.stack.auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether auto stack detection is enabled.
See <a href="https://cloud.spring.io/spring-cloud-aws/">Spring Cloud AWS</a> for more information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to enable zookeeper functionality or not</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.cloud.zookeeper.connectString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The connection string for the zookeeper cluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">localhost:2181</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_grpc_server_properties"><a class="anchor" href="#_grpc_server_properties"></a><a class="link" href="#_grpc_server_properties">9.1.4. gRPC Server properties</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grpc.server.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port on which to bind the gRPC server, if enabled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grpc.server.address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The address on which to bind the gRPC server, if enabled.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_profile_specific_properties"><a class="anchor" href="#_profile_specific_properties"></a><a class="link" href="#_profile_specific_properties">9.2. Profile Specific Properties</a></h3>
<div class="sect3">
<h4 id="_prod_profile"><a class="anchor" href="#_prod_profile"></a><a class="link" href="#_prod_profile">9.2.1. Prod Profile</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDBC URL of the database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:mysql://127.0.0.1/genie?useUnicode=yes&amp;characterEncoding=UTF-8&amp;useLegacyDatetimeCode=false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username for the datasource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database password</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.data-source-properties.cachePrepStmts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration">MySQL Tuning</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.data-source-properties.prepStmtCacheSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration">MySQL Tuning</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">250</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.data-source-properties.prepStmtCacheSqlLimit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration">MySQL Tuning</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.data-source-properties.useServerPrepStmts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration">MySQL Tuning</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.data-source-properties.useLocalSessionState</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration">MySQL Tuning</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.data-source-properties.useLocalTransactionState</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration">MySQL Tuning</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.data-source-properties.rewriteBatchedStatements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration">MySQL Tuning</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.data-source-properties.cacheResultSetMetadata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration">MySQL Tuning</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.data-source-properties.elideSetAutoCommits</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration">MySQL Tuning</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.data-source-properties.maintainTimeStats</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration">MySQL Tuning</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_metrics"><a class="anchor" href="#_metrics"></a><a class="link" href="#_metrics">10. Metrics</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following is an extensive list of metrics (counters, timers, gauges, &#8230;&#8203;)
published organically by Genie, in addition to metrics published by Spring, JVM
and system metrics and statistics.</p>
</div>
<div class="paragraph">
<p>Metrics are collected using <a href="http://micrometer.io/">Micrometer</a> which allows system admins to plugin a variety of backend
collection systems (Atlas, Datadog, Graphite, Ganglia, etc). See <a href="http://micrometer.io/">website</a> for more details. Genie
ships with no backend system compiled in. It will have to be added if one is desired otherwise metrics are just
published within the local JVM and available on the Actuator <code>/metrics</code> endpoint.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 71.4285%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1431%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Unit</th>
<th class="tableblock halign-center valign-top">Source</th>
<th class="tableblock halign-center valign-top">Tags</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.submit.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken initialize the job environment (working directory, script) and fork the children</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobLauncher</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.tasks.applicationTask.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to stage all applications that a job depends on</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ApplicationTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, applicationId, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.tasks.applicationTask.applicationSetup.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to set up individual applications (creating folders, staging dependencies and configurations)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ApplicationTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>applicationId, applicationName</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.tasks.clusterTask.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to set up cluster a job runs on (creating folders, staging dependencies and configurations)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ClusterTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>clusterId, clusterName, status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.tasks.commmandTask.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to set up commmand a job runs (creating folders, staging dependencies and configurations)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CommmandTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>commmandId, commmandName, status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.tasks.initialSetupTask.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to set up job environment (creating folder structure, shell environment script)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>InitialSetupTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.tasks.jobFailureAndKillHandlerLogicTask.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to set up run script section that deals with child process termination</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobFailureAndKillHandlerLogicTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.tasks.jobKickoffTask.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to complete job launch</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobKickoffTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.tasks.jobTask.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to set up job-specific environment (creating folders, staging attachments, dependencies)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.file.cache.hitRate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File cache hit ratio</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ratio</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CacheGenieFileTransferService</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.file.cache.missRate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File cache miss ratio</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ratio</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CacheGenieFileTransferService</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.file.cache.loadExceptionRate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File cache loading exception ratio</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">ratio</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CacheGenieFileTransferService</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.coordination.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to initialize the job database record and resolve applications, command, cluster, based on criteria and load balancing strategy.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobCoordinatorServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.submit.localRunner.setJobEnvironment.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to persist the job runtime information in the database</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobCoordinatorServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.running.gauge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of jobs currently running locally</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">amount</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobStateServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.active.gauge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of jobs currently active locally</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">amount</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobStateServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.memory.used.gauge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total amount of memory allocated to local jobs (according to job request)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Megabytes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobStateServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.unableToCancel.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Count number of times a job asynchronous task cancelling was requested and failed (failure to cancel may be due to the task no longer being running)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobStateServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.submit.localRunner.overall.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time takend to submit a new job (create workspace and scripts, register in database and kick off)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>LocalJobRunner</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.submit.localRunner.createJobDir.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to create a job working directory (includes failures to create)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>LocalJobRunner</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.submit.localRunner.createRunScript.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to create the job run script</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>LocalJobRunner</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.submit.localRunner.executeJob.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to execute the job workflow tasks</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>LocalJobRunner</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.submit.localRunner.saveJobExecution.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to persist information about job execution</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>LocalJobRunner</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.submit.localRunner.publishJobStartedEvent.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to publish the event that announces a job has started</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>LocalJobRunner</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.submit.localRunner.createInitFailureDetailsFile.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to write a file with details about failure to launch a job</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>LocalJobRunner</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.files.s3.download.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to download a file from S3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>S3FileTransferImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.files.s3.upload.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to upload a local file to S3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>S3FileTransferImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.files.s3.getObjectMetadata.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to obtain S3 file metadata (modification time)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>S3FileTransferImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.files.s3.failStrictValidation.counter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Count the number of times a S3 URL fails strict validation, but is allowed through anyway</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>S3FileTransferImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.web.controllers.exception</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts exceptions returned to the user</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>GenieExceptionMapper</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>exceptionClass (*)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.api.v3.jobs.submitJobWithoutAttachments.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of jobs submitted without an attachment</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobRestController</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.api.v3.jobs.submitJobWithAttachments.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of jobs submitted with one or more attachments</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobRestController</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.security.oauth2.pingFederate.authentication.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to process JWT token and obtain OAuth2 authentication</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>PingFederateJWTTokenServices</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.security.oauth2.pingFederate.tokenValidation.error.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of token validation errors from the backend</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>PingFederateRemoteTokenServices</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.security.oauth2.pingFederate.authentication.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to process authentication token and obtain OAuth2 for an API request</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>PingFederateRemoteTokenServices</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.security.oauth2.pingFederate.api.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">?</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>PingFederateRemoteTokenServices</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.security.oauth2.pingFederate.jwt.validation.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to validate a JWT token claim</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>PingFederateValidator</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.security.saml.parse.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to load or create user details based on SAML parameters</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>SAMLUserDetailsServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.files.http.download.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to download a file from via HTTP</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HttpFileTransferImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.files.http.upload.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to upload a file via HTTP</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HttpFileTransferImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.files.http.getLastModified.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to retrieve last modification time for a HTTP document</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HttpFileTransferImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.clusters.loadBalancers.script.select.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken by the loaded script to select a cluster among the one passed as input</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ScriptLoadBalancer</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.clusters.loadBalancers.script.update.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to reload the script</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ScriptLoadBalancer</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.completion.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to perform post-job-completion finalization such as folder cleanup, archival and email notification.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobCompletionService</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>error, status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.errors.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts various kinds of nonfatal errors encountered (email, archival, cleanup, &#8230;&#8203;). A single request may increment for multiple errors.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobCompletionService</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>error</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.successfulStatusCheck.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the successful checks made on locally running jobs</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobMonitor</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.timeout.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of jobs killed for exceeding the maximum allowed run time</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobMonitor</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.finished.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of jobs that completed (successfully or not)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobMonitor</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.unsuccessfulStatusCheck.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of time an exception was raised while trying to check on a locally running job</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobMonitor</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.stdOutTooLarge.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of jobs killed for exceeding the maximum allowed standard output limit</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobMonitor</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.stdErrTooLarge.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of jobs killed for exceeding the maximum allowed standard error limit</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobMonitor</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.jobs.unableToReAttach.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of times a genie node failed to resume monitoring a local job process after server restart</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobMonitoringCoordinator</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.tasks.clusterChecker.errorCounts.gauge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of Genie nodes that the current leader failed is presently failing to contact</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Current amount</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ClusterCheckerTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.tasks.clusterChecker.lostJobs.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of jobs marked as "lost" due to a consistent failure to contact the Genie node hosting them</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ClusterCheckerTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.tasks.clusterChecker.unableToUpdateJob.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of time an exception was raised while trying to update the database status of a lost job</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ClusterCheckerTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.tasks.databaseCleanup.numDeletedClusters.gauge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of terminated cluster records purged during the last database cleanup pass</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">amount</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DatabaseCleanupTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.tasks.databaseCleanup.numDeletedFiles.gauge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of unused file references purged during the last database cleanup pass</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">amount</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DatabaseCleanupTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.tasks.databaseCleanup.numDeletedJobs.gauge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of job records purged during the last database cleanup pass</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">amount</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DatabaseCleanupTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.tasks.databaseCleanup.numDeletedTags.gauge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of unused tag records purged during the last database cleanup pass</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">amount</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DatabaseCleanupTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.tasks.databaseCleanup.duration.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to cleanup database records for jobs that executed over a given amount of time in the past</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DatabaseCleanupTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.tasks.diskCleanup.numberDeletedJobDirs.gauge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of job folders deleted during the last cleanup pass</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">amount</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DiskCleanupTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.tasks.diskCleanup.numberDirsUnableToDelete.gauge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of failures deleting job folders during the last cleanup pass</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">amount</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DiskCleanupTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.tasks.diskCleanup.unableToGetJobs.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of times a local job folder is encountered during cleanup and the corresponding job record in the database cannot be found</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DiskCleanupTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.tasks.diskCleanup.unableToDeleteJobsDir.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counts the number of times a local job folder could not be deleted</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DiskCleanupTask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.services.specification.clusterCommandQuery.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to query the database and find clusters and commands matching the supplied criteria.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobSpecificationServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.services.specification.loadBalancer.counter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for cluster load balancer algorithms invocations</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobSpecificationServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>class, status</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.services.specification.selectApplications.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to retrieve applications information for this task</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobSpecificationServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.services.specification.selectCluster.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to select a cluster using the load balancing strategy</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobSpecificationServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.services.specification.selectCluster.noneSelected.counter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of times the cluster load balancing terminated without selecting a cluster</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobSpecificationServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.services.specification.selectCluster.noneFound.counter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of times the criteria for cluster selection does not match any cluster</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobSpecificationServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.services.specification.selectCommand.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken to resolve a command based on criteria and cluster</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>JobSpecificationServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.health.endpoint.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken for the Health endpoint to collect and aggregate state from health indicators</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HealthCheckMetricsAspect</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.health.indicator.timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time taken for each health indicator to report its status</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nanoseconds</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HealthCheckMetricsAspect</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass, healthIndicatorClass</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.health.indicator.counter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for of calls each health indicator tagged by reported status</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HealthCheckMetricsAspect</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass, healthIndicatorName</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.health.failure.counter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for calls each health indicator that reports status other than UP</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>HealthCheckMetricsAspect</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass, healthIndicatorName</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>genie.services.agentJob.handshake.counter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter for calls to the 'handshake' protocol of the Genie Agent Job Service</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>AgentJobServiceImpl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>status, exceptionClass, agentVersion, agentHost, handshakeDecision</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(*) Source may add additional tags on a case-by-case basis</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 4.0.0-SNAPSHOT<br>
Last updated 2019-01-30 22:05:04 UTC
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>